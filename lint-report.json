[{"filePath":"C:\\dev\\Interview-Coach-Recruiter\\src\\app\\(recruiter)\\recruiter\\settings\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":35,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":35,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":39,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":39,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":169,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":169,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6566,6569],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6566,6569],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport { createBrowserClient } from \"@supabase/ssr\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Card, CardHeader, CardTitle, CardContent, CardDescription, CardFooter } from \"@/components/ui/card\";\r\nimport { Loader2, Save } from \"lucide-react\";\r\nimport { cn } from \"@/lib/cn\";\r\n\r\n// --- Types ---\r\ninterface RecruiterProfile {\r\n    recruiter_id: string;\r\n    first_name: string;\r\n    last_name: string;\r\n    phone: string;\r\n    timezone: string;\r\n}\r\n\r\n// --- Timezone Helper ---\r\nconst getTimezones = () => {\r\n    try {\r\n        // Modern approach: Intl.supportedValuesOf('timeZone')\r\n        const zones = Intl.supportedValuesOf('timeZone');\r\n        // Sort and format?\r\n        // Let's create a display map\r\n        return zones.map(zone => {\r\n            // Get offset? A bit complex without libraries like date-fns-tz or moment-timezone.\r\n            // Simplified: Just use the zone string.\r\n            // Or try to format:\r\n            try {\r\n                const short = new Intl.DateTimeFormat('en-US', { timeZone: zone, timeZoneName: 'shortOffset' }).formatToParts().find(p => p.type === 'timeZoneName')?.value || '';\r\n                const long = new Intl.DateTimeFormat('en-US', { timeZone: zone, timeZoneName: 'long' }).formatToParts().find(p => p.type === 'timeZoneName')?.value || '';\r\n                return { value: zone, label: `(${short}) ${long} - ${zone}` };\r\n            } catch (e) {\r\n                return { value: zone, label: zone };\r\n            }\r\n        });\r\n    } catch (e) {\r\n        // Fallback for older environments\r\n        return [\r\n            { value: \"UTC\", label: \"UTC\" },\r\n            { value: \"America/New_York\", label: \"Eastern Time (US & Canada)\" },\r\n            { value: \"America/Chicago\", label: \"Central Time (US & Canada)\" },\r\n            { value: \"America/Denver\", label: \"Mountain Time (US & Canada)\" },\r\n            { value: \"America/Los_Angeles\", label: \"Pacific Time (US & Canada)\" },\r\n            { value: \"Europe/London\", label: \"London\" },\r\n            // Add more as needed\r\n        ];\r\n    }\r\n};\r\n\r\nconst TIMEZONES = getTimezones();\r\n\r\nexport default function SettingsPage() {\r\n    const router = useRouter();\r\n    const [isLoading, setIsLoading] = useState(true);\r\n    const [isSaving, setIsSaving] = useState(false);\r\n    const [error, setError] = useState<string | null>(null);\r\n    const [successMessage, setSuccessMessage] = useState<string | null>(null);\r\n\r\n    // Initial state (from DB)\r\n    const [initialProfile, setInitialProfile] = useState<RecruiterProfile | null>(null);\r\n\r\n    // Working state (User inputs)\r\n    const [profile, setProfile] = useState<RecruiterProfile>({\r\n        recruiter_id: \"\",\r\n        first_name: \"\",\r\n        last_name: \"\",\r\n        phone: \"\",\r\n        timezone: Intl.DateTimeFormat().resolvedOptions().timeZone || \"UTC\"\r\n    });\r\n\r\n    const supabase = createBrowserClient(\r\n        process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n        process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\r\n    );\r\n\r\n    // --- Fetch Logic ---\r\n    useEffect(() => {\r\n        const fetchProfile = async () => {\r\n            setIsLoading(true);\r\n            const { data: { user }, error: authError } = await supabase.auth.getUser();\r\n\r\n            if (authError || !user) {\r\n                router.push(\"/login\");\r\n                return;\r\n            }\r\n\r\n            // Fetch existing profile\r\n            const { data, error } = await supabase\r\n                .from('recruiter_profiles')\r\n                .select('*')\r\n                .eq('recruiter_id', user.id)\r\n                .single();\r\n\r\n            if (error && error.code !== 'PGRST116') { // PGRST116 = JSON object requested, multiple (or no) rows returned\r\n                console.error(\"Error fetching profile:\", error);\r\n                setError(\"Failed to load profile.\");\r\n            } else if (data) {\r\n                // Found\r\n                const cleanData = {\r\n                    recruiter_id: user.id,\r\n                    first_name: data.first_name || \"\",\r\n                    last_name: data.last_name || \"\",\r\n                    phone: data.phone || \"\",\r\n                    timezone: data.timezone || Intl.DateTimeFormat().resolvedOptions().timeZone || \"UTC\"\r\n                };\r\n                setInitialProfile(cleanData);\r\n                setProfile(cleanData);\r\n            } else {\r\n                // Not found (First Run)\r\n                // We initialize with empty strings but valid ID\r\n                // No existing initialProfile to compare against yet? Or treat as empty?\r\n                // Let's treat initial as empty so \"Save\" is active if they typed anything.\r\n                const emptyProfile = {\r\n                    recruiter_id: user.id,\r\n                    first_name: \"\",\r\n                    last_name: \"\",\r\n                    phone: \"\",\r\n                    timezone: Intl.DateTimeFormat().resolvedOptions().timeZone || \"UTC\"\r\n                };\r\n                setInitialProfile(emptyProfile);\r\n                setProfile(emptyProfile);\r\n\r\n                // Pre-fill email from auth? Profile doesn't store email, Sidebar uses auth email.\r\n            }\r\n            setIsLoading(false);\r\n        };\r\n\r\n        fetchProfile();\r\n    }, [router, supabase]);\r\n\r\n\r\n    // --- Dirty Check ---\r\n    const isDirty = initialProfile && JSON.stringify(profile) !== JSON.stringify(initialProfile);\r\n\r\n    // --- Actions ---\r\n\r\n    const handleSave = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        if (!isDirty) return;\r\n\r\n        setIsSaving(true);\r\n        setError(null);\r\n        setSuccessMessage(null);\r\n\r\n        try {\r\n            // Upsert\r\n            const { error } = await supabase\r\n                .from('recruiter_profiles')\r\n                .upsert({\r\n                    recruiter_id: profile.recruiter_id,\r\n                    first_name: profile.first_name,\r\n                    last_name: profile.last_name,\r\n                    phone: profile.phone,\r\n                    timezone: profile.timezone,\r\n                    updated_at: new Date().toISOString()\r\n                });\r\n\r\n            if (error) throw error;\r\n\r\n            // Update initial state to match new state\r\n            setInitialProfile({ ...profile });\r\n            setSuccessMessage(\"Profile updated successfully.\");\r\n\r\n            // Clear success message after 3s\r\n            setTimeout(() => setSuccessMessage(null), 3000);\r\n        } catch (err: any) {\r\n            console.error(err);\r\n            setError(err.message || \"Failed to save profile.\");\r\n        } finally {\r\n            setIsSaving(false);\r\n        }\r\n    };\r\n\r\n    const handleCancel = () => {\r\n        if (initialProfile) {\r\n            setProfile({ ...initialProfile });\r\n            setError(null);\r\n            setSuccessMessage(null);\r\n        }\r\n    };\r\n\r\n    // --- Render ---\r\n\r\n    if (isLoading) {\r\n        return (\r\n            <div className=\"flex items-center justify-center p-12\">\r\n                <Loader2 className=\"w-8 h-8 animate-spin text-slate-400\" />\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"max-w-2xl mx-auto space-y-6\">\r\n            <div>\r\n                <h1 className=\"text-3xl font-bold text-slate-800\">Account Settings</h1>\r\n                <p className=\"text-slate-500\">Manage your profile and display preferences.</p>\r\n            </div>\r\n\r\n            <form onSubmit={handleSave}>\r\n                <Card className=\"border-t-4 border-t-primary shadow-sm bg-white\">\r\n                    <CardHeader>\r\n                        <CardTitle>Profile Details</CardTitle>\r\n                        <CardDescription>\r\n                            Your name and contact information will appear on candidate invites and emails.\r\n                        </CardDescription>\r\n                    </CardHeader>\r\n                    <CardContent className=\"space-y-4\">\r\n                        {error && (\r\n                            <div className=\"p-3 bg-red-50 text-red-600 text-sm rounded-md border border-red-100 flex items-start gap-2\">\r\n                                <span>⚠️</span>\r\n                                <span>{error}</span>\r\n                            </div>\r\n                        )}\r\n                        {successMessage && !isDirty && (\r\n                            <div className=\"p-3 bg-emerald-50 text-emerald-600 text-sm rounded-md border border-emerald-100 flex items-start gap-2 animate-in fade-in slide-in-from-top-1\">\r\n                                <span>✓</span>\r\n                                <span>{successMessage}</span>\r\n                            </div>\r\n                        )}\r\n\r\n                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                            <div className=\"space-y-2\">\r\n                                <label className=\"text-sm font-medium text-slate-700\">First Name</label>\r\n                                <input\r\n                                    required\r\n                                    className=\"flex h-10 w-full rounded-md border border-slate-200 bg-white px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 focus:border-primary focus:ring-primary/20 transition-all\"\r\n                                    value={profile.first_name}\r\n                                    onChange={e => setProfile({ ...profile, first_name: e.target.value })}\r\n                                />\r\n                            </div>\r\n                            <div className=\"space-y-2\">\r\n                                <label className=\"text-sm font-medium text-slate-700\">Last Name</label>\r\n                                <input\r\n                                    required\r\n                                    className=\"flex h-10 w-full rounded-md border border-slate-200 bg-white px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 focus:border-primary focus:ring-primary/20 transition-all\"\r\n                                    value={profile.last_name}\r\n                                    onChange={e => setProfile({ ...profile, last_name: e.target.value })}\r\n                                />\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"space-y-2\">\r\n                            <label className=\"text-sm font-medium text-slate-700\">Phone Number</label>\r\n                            <input\r\n                                className=\"flex h-10 w-full rounded-md border border-slate-200 bg-white px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 focus:border-primary focus:ring-primary/20 transition-all\"\r\n                                value={profile.phone}\r\n                                onChange={e => setProfile({ ...profile, phone: e.target.value })}\r\n                                type=\"tel\"\r\n                                placeholder=\"(555) 123-4567\"\r\n                            />\r\n                        </div>\r\n\r\n                        <div className=\"space-y-2\">\r\n                            <label className=\"text-sm font-medium text-slate-700\">Display Time Zone</label>\r\n                            <div className=\"relative\">\r\n                                {/* Custom Styled Select */}\r\n                                <select\r\n                                    className=\"flex h-10 w-full items-center justify-between rounded-md border border-slate-200 bg-white px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 appearance-none focus:border-primary focus:ring-primary/20 transition-all cursor-pointer\"\r\n                                    value={profile.timezone}\r\n                                    onChange={e => setProfile({ ...profile, timezone: e.target.value })}\r\n                                >\r\n                                    {TIMEZONES.map(tz => (\r\n                                        <option key={tz.value} value={tz.value}>{tz.label}</option>\r\n                                    ))}\r\n                                </select>\r\n                                <div className=\"pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-slate-500\">\r\n                                    <svg className=\"h-4 w-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M19 9l-7 7-7-7\"></path></svg>\r\n                                </div>\r\n                            </div>\r\n                            <p className=\"text-xs text-muted-foreground\">Used for displaying session timestamps and activity logs.</p>\r\n                        </div>\r\n\r\n                    </CardContent>\r\n                    <CardFooter className=\"flex justify-between items-center bg-slate-50/50 p-4 border-t\">\r\n                        <div className=\"text-xs text-slate-400\">\r\n                            {isDirty ? \"Unsaved changes\" : \"All changes saved\"}\r\n                        </div>\r\n                        <div className=\"flex gap-3\">\r\n                            {isDirty && (\r\n                                <Button\r\n                                    type=\"button\"\r\n                                    variant=\"outline\"\r\n                                    onClick={handleCancel}\r\n                                    className=\"animate-in fade-in slide-in-from-right-1 duration-200\"\r\n                                >\r\n                                    Cancel\r\n                                </Button>\r\n                            )}\r\n                            <Button\r\n                                type=\"submit\"\r\n                                disabled={!isDirty || isSaving}\r\n                                className={cn(\r\n                                    \"transition-all duration-300 min-w-[100px]\",\r\n                                    isDirty ? \"bg-primary hover:bg-primary/90 shadow-md\" : \"opacity-70 bg-slate-300 text-slate-500 hover:bg-slate-300 cursor-not-allowed\"\r\n                                )}\r\n                            >\r\n                                {isSaving ? (\r\n                                    <>\r\n                                        <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" /> Saving\r\n                                    </>\r\n                                ) : (\r\n                                    <>\r\n                                        <Save className=\"mr-2 h-4 w-4\" /> Save\r\n                                    </>\r\n                                )}\r\n                            </Button>\r\n                        </div>\r\n                    </CardFooter>\r\n                </Card>\r\n            </form>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\dev\\Interview-Coach-Recruiter\\src\\app\\api\\analysis\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":27,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1032,1035],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1032,1035],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":28,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1080,1083],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1080,1083],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":44,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1614,1617],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1614,1617],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":47,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":47,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1694,1697],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1694,1697],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\";\r\nimport { AnalyzeAnswerSchema } from \"@/lib/domain/schemas\";\r\nimport { AIService } from \"@/lib/server/services/ai-service\";\r\n\r\nexport async function POST(request: Request) {\r\n    try {\r\n        const body = await request.json();\r\n\r\n        // Validate Input\r\n        const parseResult = AnalyzeAnswerSchema.safeParse(body);\r\n        if (!parseResult.success) {\r\n            return NextResponse.json(\r\n                { error: \"Invalid request\", details: parseResult.error.format() },\r\n                { status: 400 }\r\n            );\r\n        }\r\n\r\n        const { question, input, blueprint, intakeData } = parseResult.data;\r\n\r\n        let answerText: string | null = null;\r\n        let audioData: { base64: string; mimeType: string } | null = null;\r\n\r\n        if (typeof input === \"string\") {\r\n            answerText = input;\r\n        } else if (input && typeof input === \"object\" && \"data\" in input && \"mimeType\" in input) {\r\n            audioData = {\r\n                base64: (input as any).data,\r\n                mimeType: (input as any).mimeType\r\n            };\r\n        } else {\r\n            return NextResponse.json({ error: \"Invalid input format\" }, { status: 400 });\r\n        }\r\n\r\n        // Delegate to Service\r\n        // Adapter: Construct a minimal Question object from the string input\r\n        const questionObj = {\r\n            id: parseResult.data.questionId || \"temp\",\r\n            text: question,\r\n            category: \"General\",\r\n            index: 0\r\n        };\r\n\r\n        const analysis = await AIService.analyzeAnswer(\r\n            questionObj as any,\r\n            answerText,\r\n            audioData,\r\n            blueprint as any,\r\n            intakeData\r\n        );\r\n\r\n        return NextResponse.json(analysis);\r\n\r\n    } catch (error) {\r\n        console.error(\"Analysis API Error:\", error);\r\n        return NextResponse.json(\r\n            { error: \"Analysis Failed\" },\r\n            { status: 500 }\r\n        );\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\dev\\Interview-Coach-Recruiter\\src\\app\\api\\recruiter\\invites\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'mockUser' is assigned a value but never used.","line":37,"column":23,"nodeType":"Identifier","messageId":"unusedVar","endLine":37,"endColumn":31},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":80,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":80,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2799,2802],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2799,2802],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\";\r\nimport { uuidv7 } from \"uuidv7\";\r\nimport { SupabaseInviteRepository } from \"@/lib/server/infrastructure/supabase-invite-repository\";\r\nimport { createClient } from \"@/lib/supabase/server\";\r\nimport { Invite } from \"@/lib/domain/invite\";\r\nimport { z } from \"zod\";\r\nimport { randomBytes } from \"crypto\";\r\n\r\nconst repository = new SupabaseInviteRepository();\r\n\r\nconst CreateInviteSchema = z.object({\r\n    role: z.string().min(1),\r\n    jobDescription: z.string().optional(),\r\n    candidate: z.object({\r\n        firstName: z.string().min(1),\r\n        lastName: z.string().min(1),\r\n        email: z.string().email(),\r\n        reqId: z.string().min(1)\r\n    }),\r\n    questions: z.array(z.object({\r\n        text: z.string().min(1),\r\n        category: z.string(),\r\n        index: z.number()\r\n    }))\r\n});\r\n\r\nexport async function POST(request: Request) {\r\n    try {\r\n        const supabase = createClient();\r\n        const { data: { user }, error } = await supabase.auth.getUser();\r\n\r\n        if (error || !user) {\r\n            // Dev Bypass for mobile testing\r\n            if (process.env.NODE_ENV === 'development') {\r\n                console.warn(\"⚠️ Bypass Auth for Dev Environment\");\r\n                // Mock user object\r\n                const mockUser = { id: \"00000000-0000-0000-0000-000000000000\" };\r\n                // Continue with mock user\r\n                // redefine user variable or just handle it below?\r\n                // Easier to Just proceed with mock id in the invite creation\r\n            } else {\r\n                return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\r\n            }\r\n        }\r\n\r\n        const userId = user?.id || \"00000000-0000-0000-0000-000000000000\";\r\n\r\n        const body = await request.json();\r\n        const { role, jobDescription, candidate, questions } = CreateInviteSchema.parse(body);\r\n\r\n        // Secure Random Token\r\n        const token = randomBytes(16).toString('hex');\r\n        const sessionId = uuidv7();\r\n\r\n        const invite: Invite = {\r\n            id: sessionId,\r\n            token,\r\n            role,\r\n            jobDescription,\r\n            candidate,\r\n            questions,\r\n            createdBy: userId,\r\n            createdAt: Date.now()\r\n        };\r\n\r\n        // Use Admin Client if bypassing auth (RLS Bypass)\r\n        if (userId === \"00000000-0000-0000-0000-000000000000\") {\r\n            const { createAdminClient } = await import(\"@/lib/supabase/server\");\r\n            const adminClient = createAdminClient();\r\n            await repository.create(invite, adminClient);\r\n        } else {\r\n            await repository.create(invite);\r\n        }\r\n\r\n        return NextResponse.json({\r\n            invite,\r\n            link: `/s/${token}`\r\n        });\r\n\r\n    } catch (error: any) {\r\n        console.error(\"Invite Create Error:\", error);\r\n        return NextResponse.json({\r\n            error: error instanceof z.ZodError ? error.issues : error.message || \"Failed to create invite\"\r\n        }, { status: 500 });\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\dev\\Interview-Coach-Recruiter\\src\\app\\api\\tts\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":58,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":58,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2171,2174],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2171,2174],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from \"next/server\";\r\nimport { GoogleGenAI } from \"@google/genai\";\r\n\r\n// export const runtime = 'edge'; // Optional: Use edge if compatible, otherwise default to node\r\n// GenAI SDK might rely on Node built-ins, so keeping standard runtime for safety initially.\r\n\r\nexport async function POST(request: Request) {\r\n    try {\r\n        const apiKey = process.env.GEMINI_API_KEY;\r\n        if (!apiKey) {\r\n            return NextResponse.json({ error: \"Missing API Key\" }, { status: 500 });\r\n        }\r\n\r\n        const body = await request.json();\r\n        const { text } = body;\r\n\r\n        if (!text) {\r\n            return NextResponse.json({ error: \"Missing text\" }, { status: 400 });\r\n        }\r\n\r\n        const ai = new GoogleGenAI({ apiKey });\r\n\r\n        // Instruction to ensure clean reading\r\n        const wrappedText = `Instruction: Read the following interview question as a hiring manager addressing a candidate. Tone: Professional, clear, engaging.\\n\\n\"${text}\"`;\r\n\r\n        const response = await ai.models.generateContent({\r\n            model: 'gemini-2.5-flash',\r\n            contents: {\r\n                parts: [{ text: wrappedText }],\r\n            },\r\n            config: {\r\n                responseModalities: ['AUDIO'],\r\n                speechConfig: {\r\n                    voiceConfig: {\r\n                        prebuiltVoiceConfig: {\r\n                            voiceName: 'Sulafat',\r\n                        },\r\n                    },\r\n                },\r\n            },\r\n        });\r\n\r\n        const candidate = response.candidates?.[0];\r\n        const part = candidate?.content?.parts?.[0];\r\n\r\n        if (!part?.inlineData?.data) {\r\n            throw new Error(\"No audio data returned\");\r\n        }\r\n\r\n        // Return as JSON with Base64 (Simulating stream via client-side playback for V1)\r\n        // True streaming would require piping the response body, but GenAI SDK returns full completion currently for Audio modality in this pattern\r\n\r\n        return NextResponse.json({\r\n            audioBase64: part.inlineData.data,\r\n            mimeType: part.inlineData.mimeType || 'audio/mpeg'\r\n        });\r\n\r\n    } catch (error: any) {\r\n        console.error(\"TTS API Error:\", error);\r\n        return NextResponse.json({ error: error.message || \"TTS Failed\" }, { status: 500 });\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\dev\\Interview-Coach-Recruiter\\src\\app\\login\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":54,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2141,2144],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2141,2144],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useState } from \"react\";\r\nimport { createBrowserClient } from \"@supabase/ssr\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Card, CardHeader, CardTitle, CardContent, CardDescription } from \"@/components/ui/card\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { Eye, EyeOff, Lock, Mail, UserPlus, LogIn, Loader2 } from \"lucide-react\";\r\nimport { cn } from \"@/lib/cn\";\r\n\r\nexport default function LoginPage() {\r\n    const [activeTab, setActiveTab] = useState<'login' | 'signup'>('login');\r\n    const [email, setEmail] = useState(\"\");\r\n    const [password, setPassword] = useState(\"\");\r\n    const [showPassword, setShowPassword] = useState(false);\r\n    const [loading, setLoading] = useState(false);\r\n    const [error, setError] = useState<string | null>(null);\r\n    const [successMessage, setSuccessMessage] = useState<string | null>(null);\r\n    const router = useRouter();\r\n\r\n    const supabase = createBrowserClient(\r\n        process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n        process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\r\n    );\r\n\r\n    const handleAuth = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        setLoading(true);\r\n        setError(null);\r\n        setSuccessMessage(null);\r\n\r\n        try {\r\n            if (activeTab === 'login') {\r\n                const { error } = await supabase.auth.signInWithPassword({\r\n                    email,\r\n                    password\r\n                });\r\n                if (error) throw error;\r\n                router.push(\"/recruiter/create\");\r\n                router.refresh();\r\n            } else {\r\n                const { error } = await supabase.auth.signUp({\r\n                    email,\r\n                    password,\r\n                    options: {\r\n                        emailRedirectTo: `${window.location.origin}/auth/callback?next=/recruiter/create`\r\n                    }\r\n                });\r\n                if (error) throw error;\r\n                setSuccessMessage(\"Check your email for the confirmation link!\");\r\n                setEmail(\"\");\r\n                setPassword(\"\");\r\n            }\r\n        } catch (err: any) {\r\n            setError(err.message || \"Authentication failed\");\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"min-h-screen flex items-center justify-center bg-slate-50 p-4 font-sans\">\r\n            <Card className=\"w-full max-w-md overflow-hidden border-t-4 border-t-primary shadow-xl\">\r\n                <CardHeader className=\"text-center pb-2\">\r\n                    <CardTitle className=\"text-2xl font-bold text-slate-800\">Recruiter Portal</CardTitle>\r\n                    <CardDescription>Manage your interview sessions and candidates</CardDescription>\r\n                </CardHeader>\r\n\r\n                {/* Tabs */}\r\n                <div className=\"px-6 pb-2\">\r\n                    <div className=\"grid grid-cols-2 bg-slate-100 p-1 rounded-lg\">\r\n                        <button\r\n                            onClick={() => { setActiveTab('login'); setError(null); setSuccessMessage(null); }}\r\n                            className={cn(\r\n                                \"py-2 text-sm font-medium rounded-md transition-all duration-200 flex items-center justify-center gap-2\",\r\n                                activeTab === 'login'\r\n                                    ? \"bg-white text-primary shadow-sm\"\r\n                                    : \"text-slate-500 hover:text-slate-700 hover:bg-slate-200/50\"\r\n                            )}\r\n                        >\r\n                            <LogIn size={16} /> Sign In\r\n                        </button>\r\n                        <button\r\n                            onClick={() => { setActiveTab('signup'); setError(null); setSuccessMessage(null); }}\r\n                            className={cn(\r\n                                \"py-2 text-sm font-medium rounded-md transition-all duration-200 flex items-center justify-center gap-2\",\r\n                                activeTab === 'signup'\r\n                                    ? \"bg-white text-primary shadow-sm\"\r\n                                    : \"text-slate-500 hover:text-slate-700 hover:bg-slate-200/50\"\r\n                            )}\r\n                        >\r\n                            <UserPlus size={16} /> Create Account\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n\r\n                <CardContent className=\"pt-6\">\r\n                    <form onSubmit={handleAuth} className=\"space-y-4\">\r\n                        {error && (\r\n                            <div className=\"p-3 bg-red-50 text-red-600 text-sm rounded-md border border-red-100 flex items-start gap-2 animate-in fade-in slide-in-from-top-1\">\r\n                                <span className=\"mt-0.5\">⚠️</span>\r\n                                <span>{error}</span>\r\n                            </div>\r\n                        )}\r\n                        {successMessage && (\r\n                            <div className=\"p-3 bg-emerald-50 text-emerald-600 text-sm rounded-md border border-emerald-100 flex items-start gap-2 animate-in fade-in slide-in-from-top-1\">\r\n                                <span className=\"mt-0.5\">✓</span>\r\n                                <span>{successMessage}</span>\r\n                            </div>\r\n                        )}\r\n\r\n                        <div className=\"space-y-2\">\r\n                            <label className=\"text-xs font-semibold uppercase tracking-wider text-slate-500 ml-1\">\r\n                                Email Address\r\n                            </label>\r\n                            <div className=\"relative group\">\r\n                                <Mail className=\"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-primary transition-colors h-4 w-4\" />\r\n                                <input\r\n                                    required\r\n                                    className=\"w-full h-10 pl-10 pr-3 rounded-md border border-slate-200 bg-slate-50/50 focus:bg-white focus:ring-2 focus:ring-primary/20 focus:border-primary outline-none transition-all placeholder:text-slate-400 text-sm text-slate-900\"\r\n                                    placeholder=\"name@company.com\"\r\n                                    type=\"email\"\r\n                                    value={email}\r\n                                    onChange={e => setEmail(e.target.value)}\r\n                                />\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"space-y-2\">\r\n                            <label className=\"text-xs font-semibold uppercase tracking-wider text-slate-500 ml-1\">\r\n                                Password\r\n                            </label>\r\n                            <div className=\"relative group\">\r\n                                <Lock className=\"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-primary transition-colors h-4 w-4\" />\r\n                                <input\r\n                                    required\r\n                                    className=\"w-full h-10 pl-10 pr-10 rounded-md border border-slate-200 bg-slate-50/50 focus:bg-white focus:ring-2 focus:ring-primary/20 focus:border-primary outline-none transition-all placeholder:text-slate-400 text-sm text-slate-900\"\r\n                                    placeholder={activeTab === 'signup' ? \"Create a strong password\" : \"Enter your password\"}\r\n                                    type={showPassword ? \"text\" : \"password\"}\r\n                                    value={password}\r\n                                    onChange={e => setPassword(e.target.value)}\r\n                                />\r\n                                <button\r\n                                    type=\"button\"\r\n                                    onClick={() => setShowPassword(!showPassword)}\r\n                                    className=\"absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-600 focus:outline-none\"\r\n                                >\r\n                                    {showPassword ? <EyeOff size={16} /> : <Eye size={16} />}\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"pt-2\">\r\n                            <Button className=\"w-full font-bold shadow-md hover:shadow-lg transition-all\" type=\"submit\" disabled={loading}>\r\n                                {loading ? (\r\n                                    <>\r\n                                        <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\r\n                                        {activeTab === 'login' ? \"Signing In...\" : \"Creating Account...\"}\r\n                                    </>\r\n                                ) : (\r\n                                    activeTab === 'login' ? \"Sign In\" : \"Create Account\"\r\n                                )}\r\n                            </Button>\r\n                        </div>\r\n\r\n                        {activeTab === 'login' && (\r\n                            <div className=\"text-center pt-2\">\r\n                                <a href=\"#\" className=\"text-xs text-primary hover:underline font-medium\">\r\n                                    Forgot your password?\r\n                                </a>\r\n                            </div>\r\n                        )}\r\n                    </form>\r\n                </CardContent>\r\n            </Card>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\dev\\Interview-Coach-Recruiter\\src\\components\\audio\\AudioVisualizer.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":23,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[827,830],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[827,830],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useRef } from 'react';\r\n\r\ninterface AudioVisualizerProps {\r\n    stream: MediaStream | null;\r\n    isRecording: boolean;\r\n    className?: string;\r\n}\r\n\r\nconst AudioVisualizer: React.FC<AudioVisualizerProps> = ({ stream, isRecording, className }) => {\r\n    const canvasRef = useRef<HTMLCanvasElement>(null);\r\n    const animationRef = useRef<number | null>(null);\r\n    const analyserRef = useRef<AnalyserNode | null>(null);\r\n    const contextRef = useRef<AudioContext | null>(null);\r\n\r\n    useEffect(() => {\r\n        if (!stream || !isRecording || !canvasRef.current) return;\r\n\r\n        const canvas = canvasRef.current;\r\n        const ctx = canvas.getContext('2d');\r\n        if (!ctx) return;\r\n\r\n        if (!contextRef.current) {\r\n            const AudioContextClass = window.AudioContext || (window as any).webkitAudioContext;\r\n            contextRef.current = new AudioContextClass();\r\n        }\r\n\r\n        const audioContext = contextRef.current;\r\n\r\n        // Ensure context is running (browser autoplay policy)\r\n        if (audioContext.state === 'suspended') {\r\n            audioContext.resume();\r\n        }\r\n\r\n        // Reuse analyser if possible to avoid recreating nodes improperly\r\n        if (!analyserRef.current) {\r\n            const analyser = audioContext.createAnalyser();\r\n            analyser.fftSize = 256;\r\n            analyserRef.current = analyser;\r\n        }\r\n\r\n        const analyser = analyserRef.current;\r\n\r\n        // Connect source\r\n        try {\r\n            const source = audioContext.createMediaStreamSource(stream);\r\n            source.connect(analyser);\r\n            // Verify if we need to disconnect later? \r\n            // Usually fine for this component lifecycle as we close context on unmount\r\n        } catch (e) {\r\n            // Stream might be already connected or invalid\r\n            console.warn(\"AudioVisualizer: Error connecting stream\", e);\r\n        }\r\n\r\n        const bufferLength = analyser.frequencyBinCount;\r\n        const dataArray = new Uint8Array(bufferLength);\r\n\r\n        const draw = () => {\r\n            if (!isRecording) return;\r\n\r\n            animationRef.current = requestAnimationFrame(draw);\r\n            analyser.getByteFrequencyData(dataArray);\r\n\r\n            ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n\r\n            const barWidth = (canvas.width / bufferLength) * 2.5;\r\n            let barHeight;\r\n            let x = 0;\r\n\r\n            for (let i = 0; i < bufferLength; i++) {\r\n                barHeight = dataArray[i] / 2;\r\n\r\n                // Color: Rangam Blue-ish\r\n                const r = 55;\r\n                const g = 100;\r\n                const b = 151;\r\n\r\n                // Dynamic opacity based on volume\r\n                ctx.fillStyle = `rgba(${r},${g},${b}, ${0.5 + barHeight / 200})`;\r\n\r\n                ctx.beginPath();\r\n                // Rounded tops\r\n                ctx.roundRect(x, canvas.height - barHeight, barWidth, barHeight, 5);\r\n                ctx.fill();\r\n\r\n                x += barWidth + 2;\r\n            }\r\n        };\r\n\r\n        draw();\r\n\r\n        return () => {\r\n            if (animationRef.current) cancelAnimationFrame(animationRef.current);\r\n            // We do NOT close the context here if we want to reuse it, \r\n            // but for this component which might be mounted/unmounted, closing is safer for cleanup\r\n            if (contextRef.current && contextRef.current.state !== 'closed') {\r\n                contextRef.current.close().then(() => {\r\n                    contextRef.current = null;\r\n                    analyserRef.current = null;\r\n                });\r\n            }\r\n        };\r\n    }, [stream, isRecording]);\r\n\r\n    return (\r\n        <canvas\r\n            ref={canvasRef}\r\n            width={300}\r\n            height={100}\r\n            className={className || 'w-full h-32 rounded-xl bg-transparent'}\r\n        />\r\n    );\r\n};\r\n\r\nexport default AudioVisualizer;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\dev\\Interview-Coach-Recruiter\\src\\components\\auth\\ProfileGuard.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'checked'. Either include it or remove the dependency array.","line":48,"column":8,"nodeType":"ArrayExpression","endLine":48,"endColumn":26,"suggestions":[{"desc":"Update the dependencies array to be: [checked, pathname, router]","fix":{"range":[1727,1745],"text":"[checked, pathname, router]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport { createBrowserClient } from \"@supabase/ssr\";\r\nimport { useRouter, usePathname } from \"next/navigation\";\r\n\r\nexport function ProfileGuard() {\r\n    const router = useRouter();\r\n    const pathname = usePathname();\r\n    const [checked, setChecked] = useState(false);\r\n\r\n    useEffect(() => {\r\n        // Skip if already on settings page to avoid loop\r\n        if (pathname?.includes('/recruiter/settings')) {\r\n            return;\r\n        }\r\n\r\n        const checkProfile = async () => {\r\n            const supabase = createBrowserClient(\r\n                process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n                process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\r\n            );\r\n            const { data: { user } } = await supabase.auth.getUser();\r\n\r\n            if (!user) return; // Auth guard likely handles this, or public route\r\n\r\n            // Check if profile exists\r\n            const { data, error } = await supabase\r\n                .from('recruiter_profiles')\r\n                .select('recruiter_id')\r\n                .eq('recruiter_id', user.id)\r\n                .single();\r\n\r\n            // If not found (error code PGRST116) or data is null\r\n            // Also logic: \"first name, last name\" required?\r\n            // \"On first time entry via verification, route them...\"\r\n            // Usually first time means row doesn't exist.\r\n            if (error?.code === 'PGRST116' || !data) {\r\n                console.log(\"No profile found, redirecting to settings...\");\r\n                router.push('/recruiter/settings');\r\n            }\r\n            setChecked(true);\r\n        };\r\n\r\n        if (!checked) {\r\n            checkProfile();\r\n        }\r\n    }, [pathname, router]);\r\n\r\n    // This component renders nothing, just logic\r\n    return null;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\dev\\Interview-Coach-Recruiter\\src\\components\\layout\\CandidateSidebar.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'isActive' is assigned a value but never used.","line":23,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":23,"endColumn":19}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import Link from 'next/link';\r\nimport { cn } from '@/lib/cn';\r\nimport { useSession } from '@/context/SessionContext';\r\nimport { usePathname } from 'next/navigation';\r\n\r\ninterface CandidateSidebarProps {\r\n    className?: string;\r\n    onNavigate?: () => void;\r\n}\r\n\r\nexport function CandidateSidebar({ className, onNavigate }: CandidateSidebarProps) {\r\n    const { session } = useSession();\r\n    const pathname = usePathname();\r\n\r\n    // Safety check: session might be undefined initially\r\n    const candidateName = session?.candidate\r\n        ? `${session.candidate.firstName} ${session.candidate.lastName}`\r\n        : \"Candidate\";\r\n\r\n    const candidateEmail = session?.candidate?.email || \"\";\r\n\r\n    // Helper to check active state\r\n    const isActive = (path: string) => {\r\n        // Simple includes check, but can be more specific if needed\r\n        return pathname?.includes(path);\r\n    };\r\n\r\n    // Extract token from session or URL (Assuming token context or param is available via context or we assume relative links)\r\n    // Actually, simple hrefs might be tricky if we don't know the token in the sidebar component without parsing URL.\r\n    // BUT: The session context usually has the ID. The URL has the token. \r\n    // SAFEST: Use relative links if we are already under /s/[token], or parse from session.\r\n\r\n    // Strategy: We can't easily guess the token here if it's not in the session object (Type definition says 'token' is not in InterviewSession, but 'id' is).\r\n    // Let's assume the user is already at `/s/[token]/...`. \r\n    // We can use a relative link `.` or `coaching` if we are careful, OR better:\r\n    // Parsing the current pathname to preserve the token prefix.\r\n\r\n    const getLink = (suffix: string) => {\r\n        // Path format: /s/[token]/[...rest]\r\n        // We want to keep /s/[token] and append suffix (or nothing for root)\r\n        const parts = pathname?.split('/') || [];\r\n        // parts[0] = \"\", parts[1] = \"s\", parts[2] = \"token\"\r\n        if (parts.length >= 3 && parts[1] === 's') {\r\n            const prefix = `/s/${parts[2]}`;\r\n            return suffix ? `${prefix}/${suffix}` : prefix;\r\n        }\r\n        return '#';\r\n    };\r\n\r\n    return (\r\n        <aside className={cn(\"bg-white border-r p-6 h-full flex flex-col\", className)}>\r\n            <div className=\"mb-8\">\r\n                <h1 className=\"font-bold text-xl tracking-tight text-primary\">Interview Coach</h1>\r\n            </div>\r\n\r\n            <div className=\"mb-6 pb-6 border-b\">\r\n                <div className=\"text-sm font-semibold text-muted-foreground uppercase tracking-widest mb-1\">\r\n                    Candidate\r\n                </div>\r\n                <div className=\"font-medium text-lg text-foreground truncate\" title={candidateName}>\r\n                    {candidateName}\r\n                </div>\r\n            </div>\r\n\r\n            <nav className=\"space-y-2 flex-1\">\r\n                <Link\r\n                    href={getLink(\"\")}\r\n                    className={cn(\r\n                        \"block p-2 rounded font-medium transition-colors hover:bg-slate-100\",\r\n                        pathname === getLink(\"\") ? \"bg-primary/10 text-primary\" : \"text-muted-foreground\"\r\n                    )}\r\n                    onClick={onNavigate}\r\n                >\r\n                    Practice Session\r\n                </Link>\r\n\r\n                <Link\r\n                    href={getLink(\"coaching\")}\r\n                    className={cn(\r\n                        \"block p-2 rounded font-medium transition-colors hover:bg-slate-100\",\r\n                        pathname?.includes('/coaching') ? \"bg-primary/10 text-primary\" : \"text-muted-foreground\"\r\n                    )}\r\n                    onClick={onNavigate}\r\n                >\r\n                    Coaching\r\n                </Link>\r\n            </nav>\r\n\r\n            <div className=\"pt-6 mt-auto border-t\">\r\n                {/* Consistent Footer Structure */}\r\n                <div className=\"text-xs font-semibold text-muted-foreground uppercase tracking-wider mb-2\">\r\n                    Signed in as\r\n                </div>\r\n                {candidateEmail && (\r\n                    <div className=\"text-sm font-medium text-foreground truncate\" title={candidateEmail}>\r\n                        {candidateEmail}\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </aside>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\dev\\Interview-Coach-Recruiter\\src\\components\\layout\\MobileSidebar.tsx","messages":[{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":75,"column":41,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":75,"endColumn":79,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[3570,3608],"text":"// @ts-expect-error - dynamic prop injection"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport * as React from \"react\";\r\nimport { motion, AnimatePresence } from \"framer-motion\";\r\nimport { Menu, X } from \"lucide-react\";\r\nimport { Button } from \"@/components/ui/button\";\r\n\r\ninterface MobileSidebarProps {\r\n    children: React.ReactNode;\r\n}\r\n\r\nexport function MobileSidebar({ children }: MobileSidebarProps) {\r\n    const [isOpen, setIsOpen] = React.useState(false);\r\n\r\n    // Close on navigation (if children use onNavigate prop correctly, or we can just rely on the Overlay click)\r\n    // To make this robust, we clone the children to inject onNavigate if it's a valid element, \r\n    // but specific composition is safer. For now, we'll expose a wrapper.\r\n\r\n    // Actually, deeper integration: logic in the Sidebar component itself? \r\n    // Or just let the user click the overlay to close. \r\n    // Better: Pass `isOpen` state down? No, let's keep it simple:\r\n    // Sidebar links should probably close the drawer. \r\n    // We can wrap the children in a div that handles capturing clicks if we wanted, \r\n    // but for now let's just implement the drawer mechanism.\r\n\r\n    return (\r\n        <>\r\n            <Button\r\n                variant=\"ghost\"\r\n                size=\"icon\"\r\n                className=\"md:hidden fixed top-4 left-4 z-50\"\r\n                onClick={() => setIsOpen(true)}\r\n            >\r\n                <Menu size={24} />\r\n            </Button>\r\n\r\n            <AnimatePresence>\r\n                {isOpen && (\r\n                    <>\r\n                        {/* Overlay */}\r\n                        <motion.div\r\n                            initial={{ opacity: 0 }}\r\n                            animate={{ opacity: 1 }}\r\n                            exit={{ opacity: 0 }}\r\n                            className=\"fixed inset-0 bg-black/50 z-40 md:hidden\"\r\n                            onClick={() => setIsOpen(false)}\r\n                        />\r\n\r\n                        {/* Drawer */}\r\n                        <motion.div\r\n                            initial={{ x: \"-100%\" }}\r\n                            animate={{ x: 0 }}\r\n                            exit={{ x: \"-100%\" }}\r\n                            transition={{ type: \"spring\", damping: 20, stiffness: 300 }}\r\n                            className=\"fixed inset-y-0 left-0 z-50 w-3/4 max-w-sm bg-white shadow-xl md:hidden\"\r\n                        >\r\n                            <div className=\"relative h-full\">\r\n                                <Button\r\n                                    variant=\"ghost\"\r\n                                    size=\"icon\"\r\n                                    className=\"absolute top-4 right-4 z-50 text-muted-foreground\"\r\n                                    onClick={() => setIsOpen(false)}\r\n                                >\r\n                                    <X size={20} />\r\n                                </Button>\r\n                                {/* \r\n                                   Modify functionality: \r\n                                   We render children here. If children have interactive elements \r\n                                   that should close the sidebar, we might need a context or prop.\r\n                                   For this implementation, we will perform a cloneElement to inject onNavigate \r\n                                   if the child supports it, or just wrap it.\r\n                                */}\r\n                                {React.Children.map(children, child => {\r\n                                    if (React.isValidElement(child)) {\r\n                                        // @ts-ignore - dynamic prop injection\r\n                                        return React.cloneElement(child, { onNavigate: () => setIsOpen(false) });\r\n                                    }\r\n                                    return child;\r\n                                })}\r\n                            </div>\r\n                        </motion.div>\r\n                    </>\r\n                )}\r\n            </AnimatePresence>\r\n        </>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\dev\\Interview-Coach-Recruiter\\src\\context\\SessionContext.headless.test.tsx","messages":[{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Do not use \"@ts-nocheck\" because it alters compilation errors.","line":1,"column":1,"nodeType":"Line","messageId":"tsDirectiveComment","endLine":1,"endColumn":15}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// @ts-nocheck\nimport { describe, it, expect, vi, beforeEach } from 'vitest';\nimport { render, screen, waitFor } from '@testing-library/react';\nimport React, { useContext } from 'react';\nimport { SessionContext, SessionProvider } from './SessionContext';\nimport { InterviewSession } from '@/lib/domain/types';\nimport { secureStorage } from '../utils/encryption';\n\n// Mock dependencies\nvi.mock('../services/geminiService', () => ({\n  generateQuestions: vi.fn(),\n  generateQuestionTips: vi.fn(),\n  generateBlueprint: vi.fn(),\n  generateSpeech: vi.fn().mockResolvedValue('blob:url'),\n  initSession: vi.fn(),\n}));\n\nvi.mock('../services/sessionService', () => ({\n  sessionService: {\n    getSession: vi.fn(),\n    createSession: vi.fn(),\n    updateSession: vi.fn(),\n  },\n}));\n\nvi.mock('../services/supabase', () => ({\n  supabase: {\n    auth: {\n      getUser: vi.fn().mockResolvedValue({ data: { user: null } }),\n    },\n  },\n}));\n\n// Mock Secure Storage\nvi.mock('../utils/encryption', () => ({\n  secureStorage: {\n    getItem: vi.fn(),\n    setItem: vi.fn(),\n  },\n}));\n\n// Test Component to consume Context\nconst TestConsumer = () => {\n  const context = useContext(SessionContext);\n  if (!context) return <div>No Context</div>;\n\n  // Type narrowing for question text\n  let questionText = 'N/A';\n  if (context.session && context.now.currentQuestionId) {\n    const q = context.session.questions.find(q => q.id === context.now.currentQuestionId);\n    if (q) questionText = q.text;\n  }\n\n  return (\n    <div>\n      <div data-testid=\"status\">{context.now.status}</div>\n      <div data-testid=\"screen\">{context.screen}</div>\n      <div data-testid=\"question-text\">{questionText}</div>\n    </div>\n  );\n};\n\ndescribe('SessionContext Headless Integration', () => {\n  beforeEach(() => {\n    vi.clearAllMocks();\n  });\n\n  it('should derive ACTIVE state and QUESTION_SCREEN correctly from legacy session', async () => {\n    // 1. Setup Legacy State\n    const legacySession: InterviewSession = {\n      id: 'test-session',\n      role: 'Dev',\n      status: 'ACTIVE',\n      currentQuestionIndex: 0,\n      questions: [\n        {\n          id: 'q1',\n          text: 'What is React?',\n          type: 'Technical',\n          competencyId: 'c1',\n          difficulty: 'Medium',\n        },\n      ],\n      answers: {},\n    };\n\n    // 2. Mock Storage\n    vi.mocked(secureStorage.getItem).mockReturnValue(legacySession);\n\n    // 3. Render Provider\n    render(\n      <SessionProvider>\n        <TestConsumer />\n      </SessionProvider>\n    );\n\n    // 4. Assert Headless State\n    await waitFor(() => {\n      expect(screen.getByTestId('status')).toHaveTextContent(/ACTIVE/i);\n    });\n\n    expect(screen.getByTestId('screen')).toHaveTextContent(/QUESTION/i);\n    expect(screen.getByTestId('question-text')).toHaveTextContent('What is React?');\n  });\n\n  it('should derive REVIEW state and EVALUATION_SCREEN when answers exist', async () => {\n    // 1. Setup Legacy State in Review\n    const legacySession: InterviewSession = {\n      id: 'test-session',\n      role: 'Dev',\n      status: 'ACTIVE',\n      currentQuestionIndex: 0,\n      questions: [\n        {\n          id: 'q1',\n          text: 'What is React?',\n          type: 'Technical',\n          competencyId: 'c1',\n          difficulty: 'Medium',\n        },\n      ],\n      answers: {\n        q1: {\n          text: 'React is a library.',\n          analysis: {\n            answerScore: 85,\n            feedback: ['Good job'], // string[]\n            keyTerms: [],\n            missingElements: [],\n            transcript: 'React is a library.',\n            rating: 'Good',\n          },\n        },\n      },\n    };\n\n    // 2. Mock Storage\n    vi.mocked(secureStorage.getItem).mockReturnValue(legacySession);\n\n    // 3. Render\n    render(\n      <SessionProvider>\n        <TestConsumer />\n      </SessionProvider>\n    );\n\n    // 4. Assert\n    await waitFor(() => {\n      expect(screen.getByTestId('status')).toHaveTextContent(/REVIEWING/i);\n    });\n\n    // Expect REVIEW_FEEDBACK screen to be active during REVIEWING status\n    expect(screen.getByTestId('screen')).toHaveTextContent(/REVIEW_FEEDBACK/i);\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"C:\\dev\\Interview-Coach-Recruiter\\src\\context\\SessionContext.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":11,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[490,493],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[490,493],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'role' is defined but never used.","line":97,"column":33,"nodeType":"Identifier","messageId":"unusedVar","endLine":97,"endColumn":37},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'jobDescription' is defined but never used.","line":97,"column":47,"nodeType":"Identifier","messageId":"unusedVar","endLine":97,"endColumn":61},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'intakeData' is defined but never used.","line":97,"column":72,"nodeType":"Identifier","messageId":"unusedVar","endLine":97,"endColumn":82},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":118,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":118,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4354,4357],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4354,4357],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport React, { createContext, useContext, ReactNode, useEffect } from 'react';\r\nimport { InterviewSession, AnalysisResult } from '@/lib/domain/types';\r\nimport { NowState, ScreenId } from '@/lib/state/now.types';\r\nimport { useDomainSession } from '@/hooks/useDomainSession';\r\nimport { useEngagementTracker, TrackerEvent, EngagementTier } from '@/hooks/useEngagementTracker';\r\n\r\n// --- Types (Stubs or Imports) ---\r\nexport interface OnboardingIntakeV1 {\r\n    [key: string]: any;\r\n}\r\n\r\nexport interface SessionContextType {\r\n    // Legacy State (Mapped to Core where possible)\r\n    session?: InterviewSession;\r\n    startSession: (\r\n        role: string,\r\n        jobDescription?: string,\r\n        intakeData?: OnboardingIntakeV1\r\n    ) => Promise<void>;\r\n    submitInitials: (initials: string) => Promise<void>;\r\n    saveDraft: (text: string) => Promise<void>;\r\n    nextQuestion: () => void;\r\n    retryQuestion: () => void;\r\n    goToQuestion: (index: number) => void;\r\n    isLoading: boolean;\r\n\r\n    // Stubs for legacy signature compatibility\r\n    loadTipsForQuestion: (questionId: string) => Promise<void>;\r\n    saveAnswer: (\r\n        questionId: string,\r\n        answer: { audioBlob?: Blob; text?: string; analysis: AnalysisResult | null }\r\n    ) => void;\r\n    clearAnswer: (questionId: string) => void;\r\n    updateAnswerAnalysis: (questionId: string, partialAnalysis: Partial<AnalysisResult>) => void;\r\n    finishSession: () => Promise<void>;\r\n    resetSession: () => void;\r\n    analyzeCurrentQuestion: () => Promise<void>;\r\n    audioUrls: Record<string, string>;\r\n    cacheAudioUrl: (questionId: string, url: string) => void;\r\n    updateSession: (sessionId: string, updates: Partial<InterviewSession>) => Promise<void>;\r\n\r\n    // Headless Core State (The New Truth)\r\n    now: NowState;\r\n    screen: ScreenId;\r\n\r\n    // Engagement State (Hoisted)\r\n    trackEvent: (tier: EngagementTier, eventType?: string, durationSeconds?: number) => void;\r\n    engagementDebugEvents: TrackerEvent[];\r\n    isEngagementWindowOpen: boolean;\r\n    engagementWindowTimeRemaining: number;\r\n    clearDebugEvents: () => void;\r\n}\r\n\r\nexport const SessionContext = createContext<SessionContextType | undefined>(undefined);\r\n\r\nexport interface SessionProviderProps {\r\n    children: ReactNode;\r\n    sessionId?: string;\r\n    candidateToken?: string;\r\n    initialConfig?: {\r\n        role: string;\r\n        jobDescription?: string;\r\n        candidate?: {\r\n            firstName: string;\r\n            lastName: string;\r\n            email: string;\r\n        };\r\n    };\r\n}\r\n\r\nexport const SessionProvider: React.FC<SessionProviderProps> = ({\r\n    children,\r\n    sessionId,\r\n    candidateToken,\r\n    initialConfig\r\n}) => {\r\n    // The Core Hook manages the state\r\n    const { session, now, actions } = useDomainSession(sessionId, candidateToken);\r\n\r\n    // Bootstrap on mount\r\n    useEffect(() => {\r\n        if (!now.isLoaded && !sessionId) {\r\n            // Only auto-init new session if we aren't loading an existing one (e.g. via Invite)\r\n            const role = initialConfig?.role || \"Product Manager\";\r\n            // If we have candidate info in initialConfig, we can't easily pass it to specific init() yet without updating init signature or relying on backend to have it from invite.\r\n            // Actually, if sessionId is provided, useDomainSession fetches it. The initialConfig here is mostly for NEW sessions.\r\n            // But for Invites, the session ALREADY EXISTS in DB (created by Invite logic).\r\n            // So actions.init() is NOT called.\r\n            // The issue is simply that useDomainSession needs to return the candidate data it fetched.\r\n            actions.init(role);\r\n        }\r\n    }, [now.isLoaded, actions, initialConfig, sessionId]);\r\n\r\n    // Adapter Logic\r\n    const startSession = async (role: string, jobDescription?: string, intakeData?: OnboardingIntakeV1) => {\r\n        // Transition to IN_SESSION\r\n        actions.start();\r\n    };\r\n\r\n    const submitInitials = async (initials: string) => {\r\n        actions.submitInitials(initials);\r\n    };\r\n\r\n    const saveDraft = async (text: string) => {\r\n        actions.saveDraft(text);\r\n    };\r\n\r\n    const nextQuestion = () => {\r\n        actions.next();\r\n    };\r\n\r\n    const retryQuestion = () => {\r\n        actions.retry();\r\n    };\r\n\r\n    const saveAnswer = (qid: string, ans: any) => {\r\n        if (ans.text) actions.submit(ans.text);\r\n    };\r\n\r\n    const goToQuestion = (index: number) => {\r\n        actions.goToQuestion(index);\r\n    };\r\n\r\n    const loadTipsForQuestion = async () => console.log(\"loadTips not impl in V1\");\r\n    const clearAnswer = () => console.log(\"clearAnswer not impl\");\r\n    const updateAnswerAnalysis = () => console.log(\"updateAnswerAnalysis not impl\");\r\n    const finishSession = async () => console.log(\"finishSession handled by Orchestrator\");\r\n    const cacheAudioUrl = () => { };\r\n    const updateSession = async (sessionId: string, updates: Partial<InterviewSession>) => {\r\n        // We ignore sessionId param here as hook is bound to current session, \r\n        // but for safety/interface compatibility we keep it.\r\n        if (sessionId !== session?.id) console.warn(\"Context updateSession ID mismatch - updating current anyway\");\r\n        await actions.updateSession(updates);\r\n    };\r\n\r\n    const tracker = useEngagementTracker({\r\n        isEnabled: session?.status !== 'COMPLETED',\r\n        onUpdate: (seconds) => {\r\n            if (session?.id) {\r\n                // Update the session's engagedTimeSeconds in DB\r\n                // We add the delta (seconds) to the current session value?\r\n                // Wait, actions.updateSession replaces? No, usually merges. \r\n                // But we need to atomic increment? \r\n                // Currently `useEngagementTracker` returns a delta `accumulatedSeconds`.\r\n                // So we need to fetch current, add delta, and save?\r\n                // Or does backend handle increment? Backend is usually simple update.\r\n                // Optimistic update:\r\n                const currentTotal = session.engagedTimeSeconds || 0;\r\n                actions.updateSession({ engagedTimeSeconds: currentTotal + seconds });\r\n            }\r\n        },\r\n    });\r\n\r\n    const contextValue: SessionContextType = {\r\n        session,\r\n        now,\r\n        screen: now.screen,\r\n        startSession,\r\n        submitInitials,\r\n        saveDraft,\r\n        nextQuestion,\r\n        retryQuestion,\r\n        goToQuestion,\r\n        isLoading: !now.isLoaded,\r\n        loadTipsForQuestion,\r\n        saveAnswer,\r\n        clearAnswer,\r\n        updateAnswerAnalysis,\r\n        finishSession,\r\n        resetSession: actions.reset,\r\n        analyzeCurrentQuestion: actions.analyzeCurrentQuestion,\r\n        audioUrls: {}, // No audio in V1\r\n        cacheAudioUrl,\r\n        updateSession,\r\n        // Engagement\r\n        trackEvent: tracker.trackEvent,\r\n        engagementDebugEvents: tracker.debugEvents,\r\n        isEngagementWindowOpen: tracker.isWindowOpen,\r\n        engagementWindowTimeRemaining: tracker.windowTimeRemaining,\r\n        clearDebugEvents: tracker.clearDebugEvents\r\n    };\r\n\r\n    return (\r\n        <SessionContext.Provider value={contextValue}>\r\n            {children}\r\n        </SessionContext.Provider>\r\n    );\r\n};\r\n\r\nexport const useSession = () => {\r\n    const context = useContext(SessionContext);\r\n    if (context === undefined) {\r\n        throw new Error('useSession must be used within a SessionProvider');\r\n    }\r\n    return context;\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\dev\\Interview-Coach-Recruiter\\src\\hooks\\audio\\useAudioVisualizer.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":12,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[591,594],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[591,594],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useRef, useCallback, useEffect } from 'react';\r\n\r\nexport const useAudioVisualizer = () => {\r\n    const [mediaStream, setMediaStream] = useState<MediaStream | null>(null);\r\n    const audioContextRef = useRef<AudioContext | null>(null);\r\n    const analyserRef = useRef<AnalyserNode | null>(null);\r\n    const sourceRef = useRef<MediaStreamAudioSourceNode | null>(null);\r\n\r\n    // Initialize AudioContext lazily\r\n    const initAudioContext = useCallback(() => {\r\n        if (!audioContextRef.current) {\r\n            const AudioContextClass = window.AudioContext || (window as any).webkitAudioContext;\r\n            audioContextRef.current = new AudioContextClass();\r\n        }\r\n        return audioContextRef.current;\r\n    }, []);\r\n\r\n    const startVisualizer = useCallback(async (stream: MediaStream) => {\r\n        const ctx = initAudioContext();\r\n\r\n        // Resume if suspended (browser autoplay policy)\r\n        if (ctx.state === 'suspended') {\r\n            await ctx.resume();\r\n        }\r\n\r\n        // Create analyser\r\n        const analyser = ctx.createAnalyser();\r\n        analyser.fftSize = 256;\r\n        analyserRef.current = analyser;\r\n\r\n        // Create source\r\n        const source = ctx.createMediaStreamSource(stream);\r\n        source.connect(analyser);\r\n        sourceRef.current = source;\r\n\r\n        setMediaStream(stream);\r\n    }, [initAudioContext]);\r\n\r\n    const stopVisualizer = useCallback(() => {\r\n        if (sourceRef.current) {\r\n            sourceRef.current.disconnect();\r\n            sourceRef.current = null;\r\n        }\r\n        setMediaStream(null);\r\n    }, []);\r\n\r\n    // Cleanup\r\n    useEffect(() => {\r\n        return () => {\r\n            if (audioContextRef.current && audioContextRef.current.state !== 'closed') {\r\n                audioContextRef.current.close();\r\n            }\r\n        };\r\n    }, []);\r\n\r\n    return {\r\n        mediaStream,\r\n        analyser: analyserRef.current,\r\n        startVisualizer,\r\n        stopVisualizer\r\n    };\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\dev\\Interview-Coach-Recruiter\\src\\hooks\\audio\\useTextToSpeech.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'audioUrl' is assigned a value but never used.","line":6,"column":12,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":20}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useRef, useCallback, useEffect } from 'react';\r\n\r\nexport const useTextToSpeech = () => {\r\n    const [isPlaying, setIsPlaying] = useState(false);\r\n    const [isLoading, setIsLoading] = useState(false);\r\n    const [audioUrl, setAudioUrl] = useState<string | null>(null);\r\n    const audioRef = useRef<HTMLAudioElement | null>(null);\r\n\r\n    useEffect(() => {\r\n        audioRef.current = new Audio();\r\n        audioRef.current.onended = () => setIsPlaying(false);\r\n        audioRef.current.onerror = () => {\r\n            console.error(\"Audio playback error\");\r\n            setIsPlaying(false);\r\n            setIsLoading(false);\r\n        };\r\n\r\n        return () => {\r\n            if (audioRef.current) {\r\n                audioRef.current.pause();\r\n                audioRef.current.src = '';\r\n            }\r\n        };\r\n    }, []);\r\n\r\n    const speak = useCallback(async (text: string) => {\r\n        if (!text) return;\r\n\r\n        // If already playing this text (checking via a simple latch would be better, but simplified for MVP)\r\n        if (isPlaying) {\r\n            audioRef.current?.pause();\r\n            setIsPlaying(false);\r\n            return;\r\n        }\r\n\r\n        try {\r\n            setIsLoading(true);\r\n\r\n            const response = await fetch('/api/tts', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify({ text })\r\n            });\r\n\r\n            if (!response.ok) throw new Error('TTS Failed');\r\n\r\n            const data = await response.json();\r\n\r\n            if (data.audioBase64) {\r\n                const binaryString = atob(data.audioBase64);\r\n                const bytes = new Uint8Array(binaryString.length);\r\n                for (let i = 0; i < binaryString.length; i++) {\r\n                    bytes[i] = binaryString.charCodeAt(i);\r\n                }\r\n                const blob = new Blob([bytes], { type: data.mimeType });\r\n                const url = URL.createObjectURL(blob);\r\n\r\n                setAudioUrl(url);\r\n\r\n                if (audioRef.current) {\r\n                    audioRef.current.src = url;\r\n                    await audioRef.current.play();\r\n                    setIsPlaying(true);\r\n                }\r\n            }\r\n        } catch (error) {\r\n            console.error(\"TTS Error:\", error);\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    }, [isPlaying]);\r\n\r\n    const stop = useCallback(() => {\r\n        if (audioRef.current) {\r\n            audioRef.current.pause();\r\n            audioRef.current.currentTime = 0;\r\n        }\r\n        setIsPlaying(false);\r\n    }, []);\r\n\r\n    return {\r\n        speak,\r\n        stop,\r\n        isPlaying,\r\n        isLoading\r\n    };\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\dev\\Interview-Coach-Recruiter\\src\\hooks\\useDomainSession.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":229,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":229,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8928,8931],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8928,8931],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'session'. Either include it or remove the dependency array.","line":329,"column":8,"nodeType":"ArrayExpression","endLine":329,"endColumn":35,"suggestions":[{"desc":"Update the dependencies array to be: [session, buildHeaders]","fix":{"range":[12449,12476],"text":"[session, buildHeaders]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useCallback has a missing dependency: 'session'. Either include it or remove the dependency array.","line":346,"column":8,"nodeType":"ArrayExpression","endLine":346,"endColumn":35,"suggestions":[{"desc":"Update the dependencies array to be: [session, buildHeaders]","fix":{"range":[12985,13012],"text":"[session, buildHeaders]"}}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useMemo, useCallback, useEffect, useRef } from \"react\";\r\nimport { InterviewSession } from \"@/lib/domain/types\";\r\nimport { selectNow } from \"@/lib/state/selectors\";\r\n\r\nconst STORAGE_KEY = \"current_session_id\";\r\nconst TOKEN_HEADER = \"x-candidate-token\";\r\n\r\nexport function useDomainSession(initialSessionId?: string, candidateToken?: string) {\r\n    const [session, setSession] = useState<InterviewSession | undefined>(undefined);\r\n    const now = useMemo(() => selectNow(session), [session]);\r\n    const isSubmittingRef = useRef(false);\r\n\r\n    const buildHeaders = useCallback(\r\n        (includeJson = true) => {\r\n            const headers: Record<string, string> = {};\r\n            if (includeJson) {\r\n                headers[\"Content-Type\"] = \"application/json\";\r\n            }\r\n            if (candidateToken) {\r\n                headers[TOKEN_HEADER] = candidateToken;\r\n            }\r\n            return headers;\r\n        },\r\n        [candidateToken]\r\n    );\r\n\r\n    // 1. Rehydrate on Mount\r\n    useEffect(() => {\r\n        const storedId = localStorage.getItem(STORAGE_KEY);\r\n        const targetId = initialSessionId || storedId;\r\n\r\n        if (targetId && !session) {\r\n            // If explicit ID provided and differs from stored, update storage\r\n            if (initialSessionId && initialSessionId !== storedId) {\r\n                localStorage.setItem(STORAGE_KEY, initialSessionId);\r\n            }\r\n\r\n            fetch(`/api/session/${targetId}`, {\r\n                headers: buildHeaders(false)\r\n            })\r\n                .then(res => {\r\n                    if (res.ok) return res.json();\r\n                    throw new Error(\"Session not found\");\r\n                })\r\n                .then(data => setSession(data))\r\n                .catch(err => {\r\n                    console.warn(\"Rehydration failed:\", err);\r\n                    // Only clear if it was the stored one failing\r\n                    if (!initialSessionId) {\r\n                        localStorage.removeItem(STORAGE_KEY);\r\n                    }\r\n                });\r\n        }\r\n    }, [initialSessionId, buildHeaders, session]); // Depend on initialSessionId\r\n\r\n    // Actions\r\n    const init = useCallback(async (role: string) => {\r\n        try {\r\n            const response = await fetch('/api/session/start', {\r\n                method: 'POST',\r\n                headers: buildHeaders(),\r\n                body: JSON.stringify({ role })\r\n            });\r\n\r\n            if (!response.ok) throw new Error(\"Failed to start session\");\r\n\r\n            const newSession = await response.json();\r\n            setSession(newSession);\r\n            localStorage.setItem(STORAGE_KEY, newSession.id);\r\n        } catch (e) {\r\n            console.error(\"Session Init Failed\", e);\r\n        }\r\n    }, [buildHeaders]);\r\n\r\n    const refresh = useCallback(async () => {\r\n        if (!session?.id) return;\r\n        const res = await fetch(`/api/session/${session.id}`, {\r\n            headers: buildHeaders(false)\r\n        });\r\n        if (res.ok) setSession(await res.json());\r\n    }, [session?.id, buildHeaders]);\r\n\r\n    const start = useCallback(async () => {\r\n        if (!session) return;\r\n        // Optimistic UI Update\r\n        setSession(prev => prev ? { ...prev, status: \"IN_SESSION\" } : undefined);\r\n\r\n        await fetch(`/api/session/${session.id}`, {\r\n            method: 'PATCH',\r\n            headers: buildHeaders(),\r\n            body: JSON.stringify({ status: \"IN_SESSION\" })\r\n        });\r\n    }, [session, buildHeaders]);\r\n\r\n    const submit = useCallback(async (answerText: string) => {\r\n        if (!session || !now.currentQuestionId) return;\r\n        if (isSubmittingRef.current) return;\r\n        isSubmittingRef.current = true;\r\n\r\n        // Optimistic Update: Immediately transition to AWAITING_EVALUATION to show loader\r\n        setSession(prev => {\r\n            if (!prev) return undefined;\r\n            const qid = now.currentQuestionId!;\r\n            return {\r\n                ...prev,\r\n                status: \"AWAITING_EVALUATION\",\r\n                answers: {\r\n                    ...prev.answers,\r\n                    [qid]: {\r\n                        ...prev.answers[qid],\r\n                        questionId: qid,\r\n                        transcript: answerText,\r\n                        submittedAt: Date.now(),\r\n                        analysis: null,\r\n                        draft: undefined\r\n                    }\r\n                }\r\n            };\r\n        });\r\n\r\n        // But for V1, let's wait for the response to ensure persistence.\r\n        const res = await fetch(`/api/session/${session.id}/questions/${now.currentQuestionId}/submit`, {\r\n            method: 'POST',\r\n            headers: buildHeaders(),\r\n            body: JSON.stringify({ text: answerText })\r\n        });\r\n\r\n        try {\r\n            if (res.ok) {\r\n                const updated = await res.json();\r\n                console.log(\"Submit success, updated session:\", updated.status);\r\n                setSession(updated);\r\n            } else {\r\n                console.error(\"Submit failed:\", res.status, res.statusText);\r\n                // Ideally rollback status here, but for V1 we leave it or rely on user refresh\r\n            }\r\n        } finally {\r\n            isSubmittingRef.current = false;\r\n        }\r\n    }, [session, now.currentQuestionId, buildHeaders]);\r\n\r\n    const analyzeCurrentQuestion = useCallback(async () => {\r\n        if (!session || !now.currentQuestionId) return;\r\n\r\n        const res = await fetch(`/api/session/${session.id}/questions/${now.currentQuestionId}/analysis`, {\r\n            method: 'POST',\r\n            headers: buildHeaders(false)\r\n        });\r\n\r\n        if (res.ok) {\r\n            const updated = await res.json();\r\n            setSession(updated);\r\n        } else {\r\n            console.error(\"Analysis trigger failed:\", res.status, res.statusText);\r\n        }\r\n    }, [session, now.currentQuestionId, buildHeaders]);\r\n\r\n    const submitInitials = useCallback(async (initials: string) => {\r\n        if (!session) return;\r\n\r\n        // Optimistic\r\n        setSession(prev => prev ? {\r\n            ...prev,\r\n            enteredInitials: initials,\r\n            initialsRequired: false\r\n        } : undefined);\r\n\r\n        await fetch(`/api/session/${session.id}`, {\r\n            method: 'PATCH',\r\n            headers: buildHeaders(),\r\n            body: JSON.stringify({ enteredInitials: initials, initialsRequired: false })\r\n        });\r\n    }, [session, buildHeaders]);\r\n\r\n    const saveDraft = useCallback(async (text: string) => {\r\n        if (!session || !now.currentQuestionId) return;\r\n\r\n        // Optimistic: Update local session 'answers' map\r\n        // We need to structurally update the specific answer's draft\r\n        setSession(prev => {\r\n            if (!prev) return undefined;\r\n            const qid = now.currentQuestionId!;\r\n            const currentAns = prev.answers[qid] || {};\r\n\r\n            return {\r\n                ...prev,\r\n                answers: {\r\n                    ...prev.answers,\r\n                    [qid]: {\r\n                        ...currentAns,\r\n                        questionId: qid,\r\n                        draft: text\r\n                    }\r\n                }\r\n            };\r\n        });\r\n\r\n        // Server Persist\r\n        // We use a specific endpoint or just general session update?\r\n        // Let's use specific answer update endpoint if possible, or generic generic session PATCH?\r\n        // Actually, the simplest is generic session PATCH or a specific answers one.\r\n        // But `SupabaseSessionRepository` iterates ALL answers on update. That's fine for V1.\r\n        // Better: POST to `input` endpoint purely for saving draft.\r\n        // Let's use `api/session/[id]/input` or just reuse `api/session/[id]/questions/[qid]/submit` with `draft=true`?\r\n        // Or generic PATCH on session to update answers.\r\n\r\n        // Let's use a new lighter endpoint: PUT /questions/[id]/answer\r\n        // Or reuse existing submit but with \"isFinal=false\"?\r\n        const url = `/api/session/${session.id}/questions/${now.currentQuestionId}/answer`;\r\n        console.log(`[useDomainSession] saveDraft -> PUT ${url}`);\r\n\r\n        await fetch(url, {\r\n            method: 'PUT',\r\n            headers: buildHeaders(),\r\n            body: JSON.stringify({ text, isFinal: false })\r\n        }).catch(e => console.error(\"[useDomainSession] saveDraft Error:\", e));\r\n    }, [session, now.currentQuestionId, buildHeaders]);\r\n\r\n    const next = useCallback(async () => {\r\n        if (!session) return;\r\n        const nextIdx = session.currentQuestionIndex + 1;\r\n        const isComplete = nextIdx >= session.questions.length;\r\n        const nextStatus = isComplete ? \"COMPLETED\" : \"IN_SESSION\";\r\n\r\n        // Optimistic\r\n        setSession(prev => prev ? {\r\n            ...prev,\r\n            currentQuestionIndex: nextIdx,\r\n            status: nextStatus as any\r\n        } : undefined);\r\n\r\n        await fetch(`/api/session/${session.id}`, {\r\n            method: 'PATCH',\r\n            headers: buildHeaders(),\r\n            body: JSON.stringify({\r\n                currentQuestionIndex: nextIdx,\r\n                status: nextStatus\r\n            })\r\n        });\r\n    }, [session, buildHeaders]);\r\n\r\n    const retry = useCallback(async () => {\r\n        if (!session || !now.currentQuestionId) return;\r\n        const qid = now.currentQuestionId;\r\n\r\n        // Optimistic\r\n        setSession(prev => {\r\n            if (!prev) return undefined;\r\n            const currentAns = prev.answers[qid];\r\n            if (!currentAns) return prev;\r\n\r\n            return {\r\n                ...prev,\r\n                status: \"IN_SESSION\", // Force back to session mode\r\n                answers: {\r\n                    ...prev.answers,\r\n                    [qid]: {\r\n                        ...currentAns,\r\n                        submittedAt: undefined,\r\n                        analysis: undefined\r\n                        // transcript (draft) remains\r\n                    }\r\n                }\r\n            };\r\n        });\r\n\r\n        // Server Persist: We need to clear these fields.\r\n        await fetch(`/api/session/${session.id}/questions/${qid}/retry`, {\r\n            method: 'POST',\r\n            headers: buildHeaders(false)\r\n        });\r\n    }, [session, now.currentQuestionId, buildHeaders]);\r\n\r\n    const goToQuestion = useCallback(async (index: number) => {\r\n        if (!session) return;\r\n\r\n        // Validation: Can only go to questions up to the first unanswered one (furthest progress)\r\n        // Find the index of the first question that has NO submittedAt\r\n        // Actually, we iterate.\r\n        let maxAllowed = 0;\r\n        for (let i = 0; i < session.questions.length; i++) {\r\n            const q = session.questions[i];\r\n            const ans = session.answers[q.id];\r\n            if (ans?.submittedAt) {\r\n                maxAllowed = i + 1;\r\n            } else {\r\n                // This is the first unanswered one.\r\n                maxAllowed = i;\r\n                break;\r\n            }\r\n        }\r\n\r\n        // Edge case: If all are answered, maxAllowed is length - 1 (or length? depending on if we have a summary screen?)\r\n        // If we want to allow going to any question if all are answered:\r\n        if (session.answers[session.questions[session.questions.length - 1].id]?.submittedAt) {\r\n            maxAllowed = session.questions.length - 1;\r\n        }\r\n\r\n        if (index < 0 || index > maxAllowed) {\r\n            console.warn(`[useDomainSession] goToQuestion blocked: ${index} > ${maxAllowed}`);\r\n            return;\r\n        }\r\n\r\n        // Optimistic\r\n        setSession(prev => prev ? {\r\n            ...prev,\r\n            currentQuestionIndex: index,\r\n            status: \"IN_SESSION\"\r\n        } : undefined);\r\n\r\n        await fetch(`/api/session/${session.id}`, {\r\n            method: 'PATCH',\r\n            headers: buildHeaders(),\r\n            body: JSON.stringify({ currentQuestionIndex: index })\r\n        });\r\n    }, [session, buildHeaders]);\r\n\r\n    const updateSession = useCallback(async (updates: Partial<InterviewSession>) => {\r\n        if (!session) return;\r\n\r\n        // Optimistic\r\n        setSession(prev => prev ? { ...prev, ...updates } : undefined);\r\n\r\n        await fetch(`/api/session/${session.id}`, {\r\n            method: 'PATCH',\r\n            headers: buildHeaders(),\r\n            body: JSON.stringify(updates)\r\n        });\r\n    }, [session?.id, buildHeaders]);\r\n\r\n    const reset = useCallback(async () => {\r\n        if (!session) return;\r\n\r\n        // Optimistic: Clear answers, reset index, status IN_SESSION\r\n        setSession(prev => prev ? {\r\n            ...prev,\r\n            status: \"IN_SESSION\",\r\n            currentQuestionIndex: 0,\r\n            answers: {} // Clear all answers\r\n        } : undefined);\r\n\r\n        await fetch(`/api/session/${session.id}/reset`, {\r\n            method: 'POST',\r\n            headers: buildHeaders(false)\r\n        });\r\n    }, [session?.id, buildHeaders]);\r\n\r\n    return {\r\n        session,\r\n        now,\r\n        actions: {\r\n            init,\r\n            start,\r\n            submit,\r\n            submitInitials,\r\n            saveDraft,\r\n            next,\r\n            retry,\r\n            goToQuestion,\r\n            refresh,\r\n            goToQuestion,\r\n            refresh,\r\n            analyzeCurrentQuestion,\r\n            updateSession,\r\n            reset\r\n        }\r\n    };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\dev\\Interview-Coach-Recruiter\\src\\lib\\ai\\prompts.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":6,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":6,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[175,178],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[175,178],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":16,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[439,442],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[439,442],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Question, Blueprint } from \"@/lib/domain/types\";\n\nexport function buildAnalysisContext(\n    question: Question,\n    blueprint: Blueprint | undefined,\n    intakeData: any\n): string {\n\n    // --- 1. Blueprint Context ---\n    let blueprintContext = '';\n\n    if (blueprint) {\n        blueprintContext = `\nBLUEPRINT CONTEXT:\nJob Role: ${blueprint.title || 'Unknown Role'}\nCompetencies: ${JSON.stringify(blueprint.competencies?.map((c: any) => ({\n            id: c.id,\n            name: c.title || c.name,\n            definition: c.description || c.definition\n        })))}\n`;\n    }\n\n    // --- 2. Reading Level Context ---\n    const readingLevelContext = `\n    READING LEVEL:\n    - Keep language clear, professional, but accessible.\n    - Avoid excessive corporate jargon.\n    - Adopt a supportive, coaching tone.\n`;\n\n    // --- 3. Intake / Personalization Context ---\n    let struggleContext = '';\n    if (intakeData?.biggestStruggle) {\n        const s = intakeData.biggestStruggle;\n        struggleContext = `\n    USER STRUGGLE AREA (\"${s}\"):\n    - The user specifically wants help with: ${s}.\n    - ${s === 'getting_started' ? 'Focus on: Hesitation and initial framing.' : ''}\n    - ${s === 'staying_organized' ? 'Focus on: Structure and rambling.' : ''}\n    - ${s === 'explaining_impact' ? 'Focus on: Outcomes and metrics.' : ''}\n    - ${s === 'behavioral_storytelling' ? \"Focus on: STAR Method adherence.\" : ''}\n    - ${s === 'nerves_anxiety' ? 'Focus on: Tone and confidence. Be extra supportive.' : ''}\n    `;\n    }\n\n    let goalContext = '';\n    if (intakeData?.primaryGoal) {\n        const g = intakeData.primaryGoal;\n        goalContext = `\n    USER GOAL (\"${g}\"):\n    - ${g === 'build_confidence' ? 'Be extra encouraging.' : ''}\n    - ${g === 'get_more_structured' ? 'Strictly evaluate structure.' : ''}\n    - ${g === 'improve_metrics' ? 'Look for numbers and impact.' : ''}\n    `;\n    }\n\n    let stageContext = '';\n    if (intakeData?.stage) {\n        const stage = intakeData.stage;\n        stageContext = `\n    INTERVIEW STAGE (\"${stage}\"):\n    - ${stage === 'recruiter_screen' ? 'Focus on: Basic fit and clarity.' : ''}\n    - ${stage === 'hiring_manager' ? 'Focus on: Competence and depth.' : ''}\n    - ${stage === 'final_round' ? 'Focus on: Leadership and strategy.' : ''}\n    `;\n    }\n\n    // --- 4. Assembly ---\n    return `\nYou are an expert Interview Coach.\nYour goal is to evaluate the candidate's answer and provide actionable, structured feedback.\n\n${blueprintContext}\n${struggleContext}\n${goalContext}\n${stageContext}\n${readingLevelContext}\n\n**Question**: \"${question.text}\"\n**Category**: ${question.category}\n${question.competencyId ? `**Target Competency**: ${question.competencyId}` : ''}\n`;\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\dev\\Interview-Coach-Recruiter\\src\\lib\\db\\index.ts","messages":[{"ruleId":"no-var","severity":2,"message":"Unexpected var, use let or const instead.","line":5,"column":5,"nodeType":"VariableDeclaration","messageId":"unexpectedVar","endLine":5,"endColumn":34}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Pool } from 'pg';\r\n\r\n// Use a global variable to prevent multiple pools during HMR (Hot Module Replacement) in development\r\ndeclare global {\r\n    var pgPool: Pool | undefined;\r\n}\r\n\r\nconst pool = global.pgPool || new Pool({\r\n    connectionString: process.env.DATABASE_URL,\r\n    // SSL is required for Supabase outside of local Docker network\r\n    ssl: process.env.NODE_ENV === 'production' || process.env.DATABASE_URL?.includes('supabase')\r\n        ? { rejectUnauthorized: false }\r\n        : undefined\r\n});\r\n\r\nif (process.env.NODE_ENV !== 'production') {\r\n    global.pgPool = pool;\r\n}\r\n\r\nexport default pool;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\dev\\Interview-Coach-Recruiter\\src\\lib\\domain\\types.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":86,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":86,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2219,2222],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2219,2222],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"export type SessionStatus =\r\n    | 'NOT_STARTED'\r\n    | 'GENERATING_QUESTIONS'\r\n    | 'IN_SESSION'\r\n    | 'AWAITING_EVALUATION'\r\n    | 'REVIEWING'\r\n    | 'PAUSED'\r\n    | 'COMPLETED'\r\n    | 'ERROR';\r\n\r\nexport interface Blueprint {\r\n    title: string;\r\n    competencies: Array<{\r\n        id: string;\r\n        title: string;\r\n        description: string;\r\n    }>;\r\n}\r\n\r\n/**\r\n * Canonical Question Entity\r\n */\r\nexport interface Question {\r\n    id: string;\r\n    text: string;\r\n    category: string; // e.g. \"Behavioral\", \"Technical\"\r\n    framework?: string; // e.g. \"STAR\", \"Problem-Solving\"\r\n    competencyId?: string;\r\n    difficulty?: string;\r\n    index: number; // 0-based index\r\n    tips?: QuestionTips;\r\n}\r\n\r\nexport interface QuestionTips {\r\n    lookingFor: string;\r\n    pointsToCover: string[];\r\n    answerFramework: string;\r\n    industrySpecifics: {\r\n        metrics: string;\r\n        tools: string;\r\n    };\r\n    mistakesToAvoid: string[];\r\n    proTip: string;\r\n}\r\n\r\n/**\r\n * Canonical Answer Entity\r\n */\r\nexport interface Answer {\r\n    questionId: string;\r\n    transcript?: string; // Final text\r\n    audioUrl?: string; // Optional audio ref\r\n    submittedAt?: number;\r\n    analysis?: AnalysisResult;\r\n    draft?: string;\r\n}\r\n\r\n/**\r\n * Analysis Result (Model Output)\r\n */\r\nexport interface AnalysisResult {\r\n    // New Feedback Schema V2\r\n    ack?: string;\r\n    primaryFocus?: {\r\n        dimension: 'structural_clarity' | 'outcome_explicitness' | 'specificity_concreteness' | 'decision_rationale' | 'focus_relevance' | 'delivery_control';\r\n        headline: string;\r\n        body: string;\r\n    };\r\n    whyThisMatters?: string;\r\n    observations?: string[];\r\n    nextAction?: {\r\n        label: string;\r\n        actionType: 'redo_answer' | 'next_question' | 'practice_example' | 'stop_for_now';\r\n    };\r\n    meta?: {\r\n        tier: 0 | 1 | 2;\r\n        modality: 'text' | 'voice';\r\n        signalQuality: 'insufficient' | 'emerging' | 'reliable' | 'strong';\r\n        confidence: 'low' | 'medium' | 'high';\r\n    };\r\n\r\n    transcript?: string;\r\n\r\n    // Legacy / Extended Support (Optional - Mapped from V2 where possible or deprecated)\r\n    readinessBand?: 'RL1' | 'RL2' | 'RL3' | 'RL4'; // Deprecated\r\n    confidence?: any; // Deprecated (use meta.confidence)\r\n    coachReaction?: string; // Mapped to ack\r\n    strengths?: string[]; // Deprecated\r\n    opportunities?: string[]; // Deprecated\r\n    missingKeyPoints?: string[];\r\n\r\n    // Legacy fields to prevent breaking unknown consumers\r\n    answerScore?: number;\r\n    deliveryStatus?: string;\r\n    evidenceExtracts?: string[];\r\n    biggestUpgrade?: string;\r\n    redoPrompt?: string;\r\n}\r\n\r\n/**\r\n * Canonical Interview Session\r\n */\r\nexport interface InterviewSession {\r\n    id: string;\r\n    candidateName?: string;\r\n    role: string;\r\n    jobDescription?: string;\r\n    status: SessionStatus;\r\n\r\n    // The Data\r\n    questions: Question[];\r\n    currentQuestionIndex: number;\r\n    answers: Record<string, Answer>; // Keyed by questionId\r\n\r\n    // Minimal config truth\r\n    initialsRequired: boolean;\r\n    enteredInitials?: string;\r\n    coachingPreference?: 'tier0' | 'tier1' | 'tier2';\r\n\r\n    // Identity\r\n    candidate?: {\r\n        firstName: string;\r\n        lastName: string;\r\n        email: string;\r\n    };\r\n    engagedTimeSeconds?: number;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\dev\\Interview-Coach-Recruiter\\src\\lib\\server\\infrastructure\\file-invite-repository.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":31,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":31,"endColumn":23}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import fs from \"fs/promises\";\r\nimport path from \"path\";\r\nimport { Invite, InviteRepository } from \"@/lib/domain/invite\";\r\n\r\nconst DATA_DIR = path.join(process.cwd(), \".data\", \"invites\");\r\n\r\nexport class FileInviteRepository implements InviteRepository {\r\n    private async ensureDir() {\r\n        try {\r\n            await fs.access(DATA_DIR);\r\n        } catch {\r\n            await fs.mkdir(DATA_DIR, { recursive: true });\r\n        }\r\n    }\r\n\r\n    async create(invite: Invite): Promise<void> {\r\n        await this.ensureDir();\r\n        // Index by Token for fast lookup? Or ID?\r\n        // We look up by Token in \"getByToken\".\r\n        // Let's store as `[token].json` for V1 simplicity.\r\n        const filePath = path.join(DATA_DIR, `${invite.token}.json`);\r\n        await fs.writeFile(filePath, JSON.stringify(invite, null, 2));\r\n    }\r\n\r\n    async getByToken(token: string): Promise<Invite | null> {\r\n        await this.ensureDir();\r\n        const filePath = path.join(DATA_DIR, `${token}.json`);\r\n        try {\r\n            const data = await fs.readFile(filePath, \"utf-8\");\r\n            return JSON.parse(data) as Invite;\r\n        } catch (error) {\r\n            return null;\r\n        }\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\dev\\Interview-Coach-Recruiter\\src\\lib\\server\\infrastructure\\file-session-repository.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is defined but never used.","line":29,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":29,"endColumn":23}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import fs from \"fs/promises\";\r\nimport path from \"path\";\r\nimport { InterviewSession } from \"@/lib/domain/types\";\r\nimport { SessionRepository } from \"@/lib/domain/repository\";\r\n\r\nconst DATA_DIR = path.join(process.cwd(), \".data\", \"sessions\");\r\n\r\nexport class FileSessionRepository implements SessionRepository {\r\n    private async ensureDir() {\r\n        try {\r\n            await fs.access(DATA_DIR);\r\n        } catch {\r\n            await fs.mkdir(DATA_DIR, { recursive: true });\r\n        }\r\n    }\r\n\r\n    async create(session: InterviewSession): Promise<void> {\r\n        await this.ensureDir();\r\n        const filePath = path.join(DATA_DIR, `${session.id}.json`);\r\n        await fs.writeFile(filePath, JSON.stringify(session, null, 2));\r\n    }\r\n\r\n    async get(id: string): Promise<InterviewSession | null> {\r\n        await this.ensureDir();\r\n        const filePath = path.join(DATA_DIR, `${id}.json`);\r\n        try {\r\n            const data = await fs.readFile(filePath, \"utf-8\");\r\n            return JSON.parse(data) as InterviewSession;\r\n        } catch (error) {\r\n            return null;\r\n        }\r\n    }\r\n\r\n    async update(session: InterviewSession): Promise<void> {\r\n        // For file system, update is same as create (overwrite)\r\n        return this.create(session);\r\n    }\r\n\r\n    async delete(id: string): Promise<void> {\r\n        await this.ensureDir();\r\n        const filePath = path.join(DATA_DIR, `${id}.json`);\r\n        try {\r\n            await fs.unlink(filePath);\r\n        } catch {\r\n            // Ignore if already gone\r\n        }\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\dev\\Interview-Coach-Recruiter\\src\\lib\\server\\infrastructure\\postgres-invite-repository.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":53,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":53,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2085,2088],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2085,2088],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":96,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":96,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3553,3556],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3553,3556],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Invite, InviteRepository } from \"@/lib/domain/invite\";\r\nimport pool from \"@/lib/db\";\r\nimport { hashToken } from \"@/lib/server/crypto\";\r\n\r\nexport class PostgresInviteRepository implements InviteRepository {\r\n    async create(invite: Invite): Promise<void> {\r\n        const client = await pool.connect();\r\n        try {\r\n            await client.query('BEGIN');\r\n\r\n            // 1. Insert Session\r\n            await client.query(\r\n                `INSERT INTO sessions (\r\n                    session_id, recruiter_id, target_role, job_description, status, intake_json\r\n                ) VALUES ($1, $2, $3, $4, $5, $6)`,\r\n                [\r\n                    invite.id,\r\n                    invite.createdBy,\r\n                    invite.role,\r\n                    invite.jobDescription,\r\n                    'NOT_STARTED',\r\n                    { candidate: invite.candidate }\r\n                ]\r\n            );\r\n\r\n            // 2. Insert Questions\r\n            if (invite.questions && invite.questions.length > 0) {\r\n                // Bulk insert could be optimized, but loop is fine for V1\r\n                for (const q of invite.questions) {\r\n                    await client.query(\r\n                        `INSERT INTO questions (\r\n                            session_id, question_index, question_text, competencies\r\n                        ) VALUES ($1, $2, $3, $4)`,\r\n                        [\r\n                            invite.id,\r\n                            q.index,\r\n                            q.text,\r\n                            { category: q.category }\r\n                        ]\r\n                    );\r\n                }\r\n            }\r\n\r\n            // 3. Insert Token\r\n            const tokenHash = hashToken(invite.token);\r\n            await client.query(\r\n                `INSERT INTO candidate_tokens (token_hash, session_id) VALUES ($1, $2)`,\r\n                [tokenHash, invite.id]\r\n            );\r\n\r\n            await client.query('COMMIT');\r\n            console.log(\"[PostgresRepo] Invite Created Successfully:\", invite.id);\r\n        } catch (e: any) {\r\n            await client.query('ROLLBACK');\r\n            console.error(\"[PostgresRepo] Create Transaction Failed:\", e);\r\n            console.error(\"[PostgresRepo] Error Code:\", e.code);\r\n            console.error(\"[PostgresRepo] Error Detail:\", e.detail);\r\n            throw e;\r\n        } finally {\r\n            client.release();\r\n        }\r\n    }\r\n\r\n    async getByToken(token: string): Promise<Invite | null> {\r\n        const tokenHash = hashToken(token);\r\n\r\n        // Join candidate_tokens -> sessions\r\n        // questions brought in separate query for cleaner mapping\r\n        const result = await pool.query(\r\n            `SELECT \r\n                ct.session_id, \r\n                s.target_role, \r\n                s.job_description, \r\n                s.recruiter_id, \r\n                s.created_at, \r\n                s.intake_json\r\n             FROM candidate_tokens ct\r\n             JOIN sessions s ON ct.session_id = s.session_id\r\n             WHERE ct.token_hash = $1`,\r\n            [tokenHash]\r\n        );\r\n\r\n        if (result.rows.length === 0) return null;\r\n\r\n        const session = result.rows[0];\r\n\r\n        // Fetch Questions\r\n        const qResult = await pool.query(\r\n            `SELECT question_text, question_index, competencies \r\n             FROM questions \r\n             WHERE session_id = $1 \r\n             ORDER BY question_index ASC`,\r\n            [session.session_id]\r\n        );\r\n\r\n        const questions = qResult.rows.map((q: any) => ({\r\n            text: q.question_text,\r\n            index: q.question_index,\r\n            category: q.competencies?.category || \"General\"\r\n        }));\r\n\r\n        const rawCandidate = session.intake_json?.candidate || {};\r\n        const candidate = {\r\n            firstName: rawCandidate.firstName || \"\",\r\n            lastName: rawCandidate.lastName || \"\",\r\n            email: rawCandidate.email || \"\",\r\n            reqId: rawCandidate.reqId || \"\"\r\n        };\r\n\r\n        return {\r\n            id: session.session_id,\r\n            token: token,\r\n            role: session.target_role,\r\n            jobDescription: session.job_description,\r\n            candidate,\r\n            questions,\r\n            createdBy: session.recruiter_id,\r\n            createdAt: new Date(session.created_at).getTime()\r\n        };\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\dev\\Interview-Coach-Recruiter\\src\\lib\\server\\infrastructure\\postgres-session-repository.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":36,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1195,1198],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1195,1198],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":44,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1445,1448],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1445,1448],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":45,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":45,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1502,1505],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1502,1505],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'intakeJsonUpdate' is assigned a value but never used.","line":85,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":85,"endColumn":33},{"ruleId":"prefer-const","severity":2,"message":"'intakeJsonUpdate' is never reassigned. Use 'const' instead.","line":85,"column":17,"nodeType":"Identifier","messageId":"useConst","endLine":85,"endColumn":33,"fix":{"range":[2966,2992],"text":"const intakeJsonUpdate = \"\";"}},{"ruleId":"prefer-const","severity":2,"message":"'params' is never reassigned. Use 'const' instead.","line":86,"column":17,"nodeType":"Identifier","messageId":"useConst","endLine":86,"endColumn":23,"fix":{"range":[3006,3216],"text":"const params = [\r\n                session.status,\r\n                session.currentQuestionIndex,\r\n                session.role,\r\n                session.jobDescription,\r\n                session.id\r\n            ];"}}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":2,"fixableWarningCount":0,"source":"import { SessionRepository } from \"@/lib/domain/repository\";\r\nimport { InterviewSession, Question, Answer } from \"@/lib/domain/types\";\r\nimport pool from \"@/lib/db\";\r\n\r\nexport class PostgresSessionRepository implements SessionRepository {\r\n    async create(session: InterviewSession): Promise<void> {\r\n        await this.update(session);\r\n    }\r\n\r\n    async get(id: string): Promise<InterviewSession | null> {\r\n        const sRes = await pool.query(\r\n            `SELECT * FROM sessions WHERE session_id = $1`,\r\n            [id]\r\n        );\r\n        if (sRes.rows.length === 0) return null;\r\n        const sData = sRes.rows[0];\r\n\r\n        // Fetch Questions\r\n        const qRes = await pool.query(\r\n            `SELECT * FROM questions WHERE session_id = $1 ORDER BY question_index ASC`,\r\n            [id]\r\n        );\r\n\r\n        // Fetch Answers\r\n        const aRes = await pool.query(\r\n            `SELECT * FROM answers WHERE session_id = $1`,\r\n            [id]\r\n        );\r\n\r\n        // Fetch Evals\r\n        const eRes = await pool.query(\r\n            `SELECT * FROM eval_results WHERE session_id = $1`,\r\n            [id]\r\n        );\r\n\r\n        const questions: Question[] = qRes.rows.map((q: any) => ({\r\n            id: q.question_id,\r\n            text: q.question_text,\r\n            category: \"General\",\r\n            index: q.question_index\r\n        }));\r\n\r\n        const answers: Record<string, Answer> = {};\r\n        aRes.rows.forEach((a: any) => {\r\n            const myEval = eRes.rows.find((e: any) =>\r\n                e.question_id === a.question_id && e.attempt_number === a.attempt_number\r\n            );\r\n\r\n            answers[a.question_id] = {\r\n                questionId: a.question_id,\r\n                transcript: a.final_text || \"\",\r\n                draft: a.draft_text || \"\",\r\n                submittedAt: a.submitted_at ? new Date(a.submitted_at).getTime() : undefined,\r\n                analysis: myEval ? myEval.feedback_json : undefined\r\n            };\r\n        });\r\n\r\n        const intake = sData.intake_json || {};\r\n        const c = intake.candidate || {};\r\n        const candidateName = (c.firstName && c.lastName)\r\n            ? `${c.firstName} ${c.lastName}`\r\n            : c.name;\r\n\r\n        return {\r\n            id: sData.session_id,\r\n            status: sData.status,\r\n            role: sData.target_role,\r\n            jobDescription: sData.job_description,\r\n            currentQuestionIndex: sData.current_question_index,\r\n            questions,\r\n            answers,\r\n            initialsRequired: !!candidateName && !intake.entered_initials,\r\n            enteredInitials: intake.entered_initials,\r\n            candidateName\r\n        };\r\n    }\r\n\r\n    async update(session: InterviewSession): Promise<void> {\r\n        const client = await pool.connect();\r\n        try {\r\n            await client.query('BEGIN');\r\n\r\n            // 1. Update Session\r\n            // We need to merge intake_json if enteredInitials changed\r\n            let intakeJsonUpdate = \"\";\r\n            let params = [\r\n                session.status,\r\n                session.currentQuestionIndex,\r\n                session.role,\r\n                session.jobDescription,\r\n                session.id\r\n            ];\r\n\r\n            if (session.enteredInitials) {\r\n                // Fetch existing first to merge (concurrency risk accepted for V1)\r\n                const currentRes = await client.query(`SELECT intake_json FROM sessions WHERE session_id = $1`, [session.id]);\r\n                const currentIntake = currentRes.rows[0]?.intake_json || {};\r\n                const newIntake = { ...currentIntake, entered_initials: session.enteredInitials };\r\n\r\n                // Add to update\r\n                await client.query(\r\n                    `UPDATE sessions SET \r\n                        status = $1, current_question_index = $2, target_role = $3, job_description = $4, intake_json = $5, updated_at = NOW()\r\n                     WHERE session_id = $6`,\r\n                    [...params.slice(0, 4), newIntake, session.id]\r\n                );\r\n            } else {\r\n                await client.query(\r\n                    `UPDATE sessions SET \r\n                        status = $1, current_question_index = $2, target_role = $3, job_description = $4, updated_at = NOW()\r\n                     WHERE session_id = $5`,\r\n                    params\r\n                );\r\n            }\r\n\r\n            // 2. Upsert Answers\r\n            // Postgres UPSERT: INSERT ... ON CONFLICT (qs, att) DO UPDATE\r\n            for (const [qid, ans] of Object.entries(session.answers)) {\r\n                await client.query(\r\n                    `INSERT INTO answers (\r\n                        answer_id, session_id, question_id, attempt_number, modality, final_text, draft_text, submitted_at, updated_at\r\n                     ) VALUES (gen_random_uuid(), $1, $2, 1, 'text', $3, $4, $5, NOW())\r\n                     ON CONFLICT (question_id, attempt_number) \r\n                     DO UPDATE SET final_text = EXCLUDED.final_text, draft_text = EXCLUDED.draft_text, submitted_at = EXCLUDED.submitted_at, updated_at = NOW()`,\r\n                    [\r\n                        session.id,\r\n                        qid,\r\n                        ans.transcript,\r\n                        ans.draft,\r\n                        ans.submittedAt ? new Date(ans.submittedAt).toISOString() : null\r\n                    ]\r\n                );\r\n\r\n                if (ans.analysis) {\r\n                    await client.query(\r\n                        `INSERT INTO eval_results (\r\n                            eval_id, session_id, question_id, attempt_number, status, feedback_json, updated_at\r\n                         ) VALUES (gen_random_uuid(), $1, $2, 1, 'COMPLETE', $3, NOW())\r\n                         ON CONFLICT (question_id, attempt_number) \r\n                         DO UPDATE SET feedback_json = EXCLUDED.feedback_json, status = 'COMPLETE', updated_at = NOW()`,\r\n                        [session.id, qid, ans.analysis]\r\n                    );\r\n                }\r\n            }\r\n\r\n            await client.query('COMMIT');\r\n        } catch (e) {\r\n            await client.query('ROLLBACK');\r\n            throw e;\r\n        } finally {\r\n            client.release();\r\n        }\r\n    }\r\n\r\n    async delete(id: string): Promise<void> {\r\n        await pool.query(`DELETE FROM sessions WHERE session_id = $1`, [id]);\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\dev\\Interview-Coach-Recruiter\\src\\lib\\server\\infrastructure\\supabase-invite-repository.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'error' is assigned a value but never used.","line":92,"column":15,"nodeType":"Identifier","messageId":"unusedVar","endLine":92,"endColumn":20},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":99,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":99,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3689,3692],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3689,3692],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":108,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":108,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3998,4001],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3998,4001],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Invite, InviteRepository } from \"@/lib/domain/invite\";\r\nimport { createClient } from \"@/lib/supabase/server\";\r\nimport { hashToken } from \"@/lib/server/crypto\";\r\n\r\nimport { SupabaseClient } from \"@supabase/supabase-js\";\r\n\r\nexport class SupabaseInviteRepository implements InviteRepository {\r\n    async create(invite: Invite, client?: SupabaseClient): Promise<void> {\r\n        const supabase = client || createClient();\r\n\r\n        // 1. Create Session\r\n        const { data: sessionData, error: sessionError } = await supabase\r\n            .from('sessions')\r\n            .insert({\r\n                session_id: invite.id,\r\n                recruiter_id: invite.createdBy,\r\n                target_role: invite.role,\r\n                job_description: invite.jobDescription,\r\n                status: 'NOT_STARTED',\r\n                // Store candidate info in intake_json\r\n                intake_json: {\r\n                    candidate: invite.candidate\r\n                }\r\n            })\r\n            .select('session_id')\r\n            .single();\r\n\r\n        if (sessionError) {\r\n            throw new Error(`Supabase Session Create Error: ${sessionError.message}`);\r\n        }\r\n\r\n        // 2. Insert Questions\r\n        if (invite.questions && invite.questions.length > 0) {\r\n            const qRows = invite.questions.map(q => ({\r\n                session_id: invite.id,\r\n                question_index: q.index,\r\n                question_text: q.text,\r\n                competencies: { category: q.category }\r\n            }));\r\n\r\n            const { error: qError } = await supabase.from('questions').insert(qRows);\r\n            if (qError) throw new Error(`Supabase Questions Create Error: ${qError.message}`);\r\n        }\r\n\r\n        // 3. Create Candidate Token\r\n        const tokenHash = hashToken(invite.token);\r\n\r\n        const { error: tokenError } = await supabase\r\n            .from('candidate_tokens')\r\n            .insert({\r\n                token_hash: tokenHash,\r\n                session_id: sessionData.session_id\r\n            });\r\n\r\n        if (tokenError) {\r\n            throw new Error(`Supabase Token Create Error: ${tokenError.message}`);\r\n        }\r\n    }\r\n\r\n    async getByToken(token: string): Promise<Invite | null> {\r\n        const supabase = createClient();\r\n        const tokenHash = hashToken(token);\r\n\r\n        console.log(`[Repo] Looking up token: ${token} (Hash: ${tokenHash})`);\r\n\r\n        // Debug: Separate queries to isolate RLS issues\r\n        const { data: tokenData, error: tokenError } = await supabase\r\n            .from('candidate_tokens')\r\n            .select('session_id')\r\n            .eq('token_hash', tokenHash)\r\n            .single();\r\n\r\n        if (tokenError || !tokenData) {\r\n            console.error(\"[Repo] Token Lookup Failed:\", tokenError);\r\n            return null;\r\n        }\r\n\r\n        console.log(`[Repo] Token found. Linked Session ID: ${tokenData.session_id}`);\r\n\r\n        const { data: sessionData, error: sessionError } = await supabase\r\n            .from('sessions')\r\n            .select('session_id, target_role, job_description, recruiter_id, created_at, intake_json')\r\n            .eq('session_id', tokenData.session_id)\r\n            .single();\r\n\r\n        if (sessionError || !sessionData) {\r\n            console.error(\"[Repo] Session Lookup Failed (Likely RLS 'public_read_sessions' missing):\", sessionError);\r\n            return null;\r\n        }\r\n\r\n        const data = { sessions: sessionData }; // Shim for existing logic below\r\n        const error = null;\r\n\r\n        // Skip the original join query\r\n        /* \r\n        const { data, error } = await supabase ...\r\n        */\r\n\r\n        const session = data.sessions as any;\r\n\r\n        // Fetch questions separately to ensure order\r\n        const { data: qData } = await supabase\r\n            .from('questions')\r\n            .select('*')\r\n            .eq('session_id', session.session_id)\r\n            .order('question_index');\r\n\r\n        const questions = (qData || []).map((q: any) => ({\r\n            text: q.question_text,\r\n            index: q.question_index,\r\n            category: q.competencies?.category || \"General\"\r\n        }));\r\n\r\n        // Extract candidate from intake_json\r\n        const rawCandidate = session.intake_json?.candidate || {};\r\n        const candidate = {\r\n            firstName: rawCandidate.firstName || rawCandidate.name?.split(' ')[0] || \"\",\r\n            lastName: rawCandidate.lastName || rawCandidate.name?.split(' ').slice(1).join(' ') || \"\",\r\n            email: rawCandidate.email || \"\",\r\n            reqId: rawCandidate.reqId || \"\"\r\n        };\r\n\r\n        return {\r\n            id: session.session_id,\r\n            token: token,\r\n            role: session.target_role,\r\n            jobDescription: session.job_description,\r\n            candidate: candidate, // Add candidate\r\n            questions: questions, // Add questions\r\n            createdBy: session.recruiter_id,\r\n            createdAt: new Date(session.created_at).getTime()\r\n        };\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\dev\\Interview-Coach-Recruiter\\src\\lib\\server\\infrastructure\\supabase-session-repository.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":55,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2079,2082],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2079,2082],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":65,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":65,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2465,2468],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2465,2468],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":67,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2549,2552],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2549,2552],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":127,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":127,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5051,5054],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5051,5054],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":224,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":224,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8787,8790],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8787,8790],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { SessionRepository } from \"@/lib/domain/repository\";\r\nimport { InterviewSession, Question, Answer } from \"@/lib/domain/types\";\r\nimport { createClient, createAdminClient } from \"@/lib/supabase/server\";\r\n\r\nexport class SupabaseSessionRepository implements SessionRepository {\r\n    async create(session: InterviewSession): Promise<void> {\r\n        // In the new model, the session might already exist if via Invite.\r\n        // But for consistency, we Upsert the session metadata.\r\n        await this.update(session);\r\n    }\r\n\r\n    async get(id: string): Promise<InterviewSession | null> {\r\n        const supabase = createClient();\r\n\r\n        // 1. Fetch Session Metadata\r\n        const { data: sData, error: sError } = await supabase\r\n            .from('sessions')\r\n            .select('*')\r\n            .eq('session_id', id)\r\n            .single();\r\n\r\n        if (sError || !sData) return null;\r\n\r\n        // 2. Fetch Questions\r\n        const { data: qData, error: qError } = await supabase\r\n            .from('questions')\r\n            .select('*')\r\n            .eq('session_id', id)\r\n            .order('question_index');\r\n\r\n        if (qError) throw new Error(qError.message);\r\n\r\n        // 3. Fetch Answers\r\n        // We only care about the latest attempt for V1 reconstruction usually,\r\n        // or we map all. The domain `answers` is Record<questionId, Answer>.\r\n        // Domain `Answer` stores `transcript`, `analysis`.\r\n        // DB `answers` stores `draft_text`, `final_text`.\r\n        // DB `eval_results` stores `feedback_json`.\r\n        // This mapping is where the complexity lies.\r\n\r\n        const { data: aData, error: aError } = await supabase\r\n            .from('answers')\r\n            .select('*')\r\n            .eq('session_id', id);\r\n\r\n        if (aError) throw new Error(aError.message);\r\n\r\n        // Fetch Eval Results\r\n        const { data: eData } = await supabase\r\n            .from('eval_results')\r\n            .select('*')\r\n            .eq('session_id', id);\r\n\r\n        // Map Questions\r\n        const questions: Question[] = qData.map((q: any) => ({\r\n            id: q.question_id,\r\n            text: q.question_text,\r\n            category: \"General\", // Default value as DB schema might not have category column yet\r\n            index: q.question_index\r\n            // ... competencies mapping if needed\r\n        }));\r\n\r\n        // Map Answers\r\n        const answers: Record<string, Answer> = {};\r\n        aData.forEach((a: any) => {\r\n            // Find analysis\r\n            const myEval = eData?.find((e: any) => e.question_id === a.question_id && e.attempt_number === a.attempt_number);\r\n\r\n            answers[a.question_id] = {\r\n                questionId: a.question_id,\r\n                transcript: a.final_text || \"\",\r\n                draft: a.draft_text || \"\",\r\n                submittedAt: a.submitted_at ? new Date(a.submitted_at).getTime() : undefined,\r\n                analysis: myEval ? myEval.feedback_json : undefined\r\n            };\r\n        });\r\n\r\n        // Initials Logic\r\n        const intake = sData.intake_json || {};\r\n        console.log(`[SupabaseSessionRepo] Session ${id} Loaded Intake:`, JSON.stringify(intake));\r\n\r\n        const c = intake.candidate || {};\r\n        const candidateName = (c.firstName && c.lastName)\r\n            ? `${c.firstName} ${c.lastName}`\r\n            : c.name; // Fallback to legacy\r\n\r\n        const enteredInitials = intake.entered_initials;\r\n        // Require initials if candidate name is known but initials not yet entered\r\n        const initialsRequired = !!candidateName && !enteredInitials;\r\n\r\n        console.log(`[SupabaseSessionRepo] Initials Calc -> Name: \"${candidateName}\", Entered: \"${enteredInitials}\", Required: ${initialsRequired}`);\r\n\r\n        return {\r\n            id: sData.session_id,\r\n            status: sData.status,\r\n            role: sData.target_role,\r\n            jobDescription: sData.job_description,\r\n            currentQuestionIndex: sData.current_question_index,\r\n            questions,\r\n            answers,\r\n            initialsRequired,\r\n            candidateName, // Pass to UI for validation\r\n            enteredInitials,\r\n            candidate: {\r\n                firstName: c.firstName || \"\",\r\n                lastName: c.lastName || \"\",\r\n                email: c.email || \"\"\r\n            },\r\n            engagedTimeSeconds: intake.engaged_time_seconds || 0\r\n        };\r\n    }\r\n\r\n    async update(session: InterviewSession): Promise<void> {\r\n        // Use Admin Client to bypass RLS for Candidate updates\r\n        const hasKey = !!process.env.SUPABASE_SERVICE_ROLE_KEY;\r\n        console.log(`[SupabaseSessionRepo] Updating Session ${session.id} (Using Admin Client? ${hasKey})`);\r\n\r\n        const supabase = createAdminClient();\r\n\r\n        // 1. Prepare Session Update\r\n        // Map Status to valid DB Enum\r\n        let dbStatus = session.status;\r\n        if (session.status === \"AWAITING_EVALUATION\" || session.status === \"REVIEWING\") {\r\n            dbStatus = \"IN_SESSION\";\r\n        }\r\n\r\n        const updates: any = {\r\n            session_id: session.id,\r\n            status: dbStatus,\r\n            current_question_index: session.currentQuestionIndex,\r\n            target_role: session.role,\r\n            job_description: session.jobDescription\r\n        };\r\n\r\n        // Strict Merge of Intake JSON\r\n        // We fetch explicitly to ensure we don't lose data\r\n        const { data: current, error: fetchError } = await supabase\r\n            .from('sessions')\r\n            .select('intake_json')\r\n            .eq('session_id', session.id)\r\n            .single();\r\n\r\n        if (fetchError) console.error(\"Update Fetch Error:\", fetchError);\r\n\r\n        const currentIntake = current?.intake_json || {};\r\n\r\n        // If 'enteredInitials' is present in the Domain Object, ensure it persists.\r\n        // If it's NOT present (e.g. legacy object), keep what's in DB.\r\n        const nextEnteredInitials = session.enteredInitials || currentIntake.entered_initials;\r\n        // Also persist engagedTimeSeconds\r\n        const nextEngagedTimeSeconds = session.engagedTimeSeconds !== undefined ? session.engagedTimeSeconds : currentIntake.engaged_time_seconds;\r\n\r\n        updates.intake_json = {\r\n            ...currentIntake,\r\n            entered_initials: nextEnteredInitials,\r\n            engaged_time_seconds: nextEngagedTimeSeconds\r\n        };\r\n\r\n        const { error: sessionError } = await supabase\r\n            .from('sessions')\r\n            .upsert(updates);\r\n\r\n        if (sessionError) {\r\n            console.error(\"[Repo] Session Update Failed:\", sessionError);\r\n            throw new Error(sessionError.message);\r\n        }\r\n\r\n\r\n        // 2. Upsert Questions\r\n        if (session.questions.length > 0) {\r\n            const qRows = session.questions.map((q, idx) => ({\r\n                question_id: q.id,\r\n                session_id: session.id,\r\n                question_index: idx,\r\n                question_text: q.text\r\n            }));\r\n            const { error: qError } = await supabase.from('questions').upsert(qRows);\r\n            if (qError) console.error(\"Question Update Error:\", qError);\r\n        }\r\n\r\n        // 3. Upsert Answers & Evals\r\n        const aRows = [];\r\n        const eRows = [];\r\n\r\n        for (const [qid, ans] of Object.entries(session.answers)) {\r\n            aRows.push({\r\n                question_id: qid,\r\n                session_id: session.id,\r\n                final_text: ans.transcript,\r\n                draft_text: ans.draft,\r\n                submitted_at: ans.submittedAt ? new Date(ans.submittedAt).toISOString() : null,\r\n                modality: 'text'\r\n            });\r\n\r\n            if (ans.analysis) {\r\n                eRows.push({\r\n                    question_id: qid,\r\n                    session_id: session.id,\r\n                    status: 'COMPLETE',\r\n                    feedback_json: ans.analysis\r\n                });\r\n            }\r\n        }\r\n\r\n        if (aRows.length > 0) {\r\n            const { error: aError } = await supabase\r\n                .from('answers')\r\n                .upsert(aRows, { onConflict: 'question_id, attempt_number' });\r\n            if (aError) console.error(\"Answer Update Error:\", aError);\r\n        }\r\n\r\n        if (eRows.length > 0) {\r\n            const { error: eError } = await supabase\r\n                .from('eval_results')\r\n                .upsert(eRows, { onConflict: 'question_id, attempt_number' });\r\n            if (eError) console.error(\"Eval Update Error:\", eError);\r\n        }\r\n    }\r\n\r\n    async updateMetadata(id: string, updates: Partial<InterviewSession>): Promise<void> {\r\n        const supabase = createAdminClient();\r\n        // console.log(`[SupabaseSessionRepo] updateMetadata ${id}`, Object.keys(updates));\r\n\r\n        const dbUpdates: any = {};\r\n\r\n        // Map top-level fields\r\n        if (updates.status) {\r\n            let dbStatus = updates.status;\r\n            if (updates.status === \"AWAITING_EVALUATION\" || updates.status === \"REVIEWING\") {\r\n                dbStatus = \"IN_SESSION\";\r\n            }\r\n            dbUpdates.status = dbStatus;\r\n        }\r\n        if (updates.currentQuestionIndex !== undefined) dbUpdates.current_question_index = updates.currentQuestionIndex;\r\n        if (updates.role) dbUpdates.target_role = updates.role;\r\n        if (updates.jobDescription) dbUpdates.job_description = updates.jobDescription;\r\n\r\n        // Handle JSON fields (intake_json)\r\n        if (updates.engagedTimeSeconds !== undefined || updates.enteredInitials !== undefined) {\r\n            const { data: current, error: fetchError } = await supabase\r\n                .from('sessions')\r\n                .select('intake_json')\r\n                .eq('session_id', id)\r\n                .single();\r\n\r\n            if (!fetchError && current) {\r\n                const currentIntake = current.intake_json || {};\r\n                dbUpdates.intake_json = {\r\n                    ...currentIntake,\r\n                    ...(updates.enteredInitials !== undefined && { entered_initials: updates.enteredInitials }),\r\n                    ...(updates.engagedTimeSeconds !== undefined && { engaged_time_seconds: updates.engagedTimeSeconds })\r\n                };\r\n            }\r\n        }\r\n\r\n        if (Object.keys(dbUpdates).length === 0) return;\r\n\r\n        const { error } = await supabase\r\n            .from('sessions')\r\n            .update(dbUpdates)\r\n            .eq('session_id', id);\r\n\r\n        if (error) {\r\n            console.error(\"[Repo] Metadata Update Failed:\", error);\r\n            throw new Error(error.message);\r\n        }\r\n    }\r\n\r\n\r\n    async delete(id: string): Promise<void> {\r\n        const supabase = createClient();\r\n        await supabase.from('sessions').delete().eq('session_id', id);\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\dev\\Interview-Coach-Recruiter\\src\\lib\\server\\services\\ai-service.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":15,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[609,612],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[609,612],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":130,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":130,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5521,5524],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5521,5524],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { GoogleGenAI } from \"@google/genai\";\r\nimport { Question, Blueprint, AnalysisResult } from \"@/lib/domain/types\";\r\nimport { buildAnalysisContext } from \"@/lib/ai/prompts\";\r\n\r\nconst apiKey = process.env.GEMINI_API_KEY;\r\nconsole.log(\"[AIService] API Key Present?\", !!apiKey, \"Length:\", apiKey?.length);\r\nconst ai = apiKey ? new GoogleGenAI({ apiKey }) : null;\r\n\r\nexport class AIService {\r\n    static async analyzeAnswer(\r\n        question: Question,\r\n        answerText: string | null,\r\n        audioData: { base64: string; mimeType: string } | null,\r\n        blueprint?: Blueprint,\r\n        intakeData?: any\r\n    ): Promise<AnalysisResult> {\r\n\r\n        // 1. Context Construction\r\n        const contextPrompt = buildAnalysisContext(question, blueprint, intakeData);\r\n\r\n        // 2. Strict JSON System Prompt (V2 Schema)\r\n        const systemPrompt = `SYSTEM:\r\nYou are a calm, supportive interview coach.\r\nYou must produce feedback that is coaching, not evaluation.\r\n\r\nNON-NEGOTIABLE RULES:\r\n- Output MUST be valid JSON only. No prose outside JSON.\r\n- Never use scores, numbers, rankings, or comparisons to other people.\r\n- Never say pass/fail, readiness, competitive, hire, reject, or imply screening.\r\n- Never simulate an interviewer’s judgment.\r\n- Do not mention “signal quality”, “tier”, “confidence weighting”, or “model confidence”.\r\n- Keep language clear and non-technical.\r\n- Use “listener” phrasing rather than “interviewer” phrasing.\r\n\r\nSTRUCTURE RULES:\r\n- ack: exactly 1 sentence, observational, no judgment adjectives.\r\n- primaryFocus: EXACTLY ONE focus. It must be a communication lever the user can act on next.\r\n- whyThisMatters: include ONLY if tier >= 1 AND providedAllowed=true.\r\n- observations: 0–3 items. Observational only; DO NOT use advice verbs like “try/should/need”.\r\n- nextAction: EXACTLY ONE action, predictable, neutral, optional-feeling.\r\n\r\nMODALITY RULES:\r\n- If modality=\"voice\": you may reference pacing, pausing, clarity of transitions, and emphasis.\r\n  Never mention posture, eye contact, attire, facial expressions, gestures, accent, or voice quality.\r\n- If modality=\"text\": you may reference structure, clarity, and placement of outcome statements.\r\n  Never mention typing speed.\r\n\r\nTIER RULES (internal guidance only):\r\n- Tier 0: communication-only language. Do not reference role expectations or competencies. Omit whyThisMatters unless explicitly allowed and tier>=1 (so normally no).\r\n- Tier 1: you may explain why the focus helps for this role (role context). Still do not name competencies.\r\n- Tier 2: you may name ONE relevant competency (if given), but frame it as communication behavior, not evaluation.\r\n\r\nSAFETY:\r\nIf the input evidence is weak or unclear, use more tentative language and keep feedback minimal.\r\nIf you are uncertain, prefer silence (empty observations array) over invented specifics.`;\r\n\r\n        const schemaPrompt = `\r\nGenerate post-answer feedback as strict JSON matching this schema:\r\n{\r\n  \"ack\": \"string\",\r\n  \"primaryFocus\": {\r\n    \"dimension\": \"structural_clarity | outcome_explicitness | specificity_concreteness | decision_rationale | focus_relevance | delivery_control\",\r\n    \"headline\": \"string\",\r\n    \"body\": \"string\"\r\n  },\r\n  \"whyThisMatters\": \"string (optional)\",\r\n  \"observations\": [\"string\", \"string\", \"string\"],\r\n  \"nextAction\": {\r\n    \"label\": \"string\",\r\n    \"actionType\": \"redo_answer | next_question | practice_example | stop_for_now\"\r\n  },\r\n  \"meta\": {\r\n    \"tier\": 0|1|2,\r\n    \"modality\": \"text|voice\",\r\n    \"signalQuality\": \"insufficient|emerging|reliable|strong\",\r\n    \"confidence\": \"low|medium|high\"\r\n  },\r\n  \"transcript\": \"string (REQUIRED for voice input, optional for text)\"\r\n}\r\n\r\nCONTEXT (do not reveal these labels; use them only to shape delivery):\r\n- surface: recruiter_prep\r\n- modality: ${audioData ? 'voice' : 'text'}\r\n- tier: 1\r\n- signalQuality: reliable\r\n- userConfidence: medium\r\n- providedAllowedForWhy: true\r\n\r\nQUESTION:\r\n${question.text}\r\n\r\nOBSERVABLE MARKERS (facts; do not embellish):\r\n- (Heuristics disabled for audio/mixed input, rely on extensive blueprint context)\r\n\r\nFOCUS CONSTRAINT:\r\n- Choose the most relevant dimension based on the context and answer.\r\n\r\nOUTPUT REQUIREMENTS:\r\n- Output ONLY valid JSON.\r\n`;\r\n\r\n        // Mock Fallback\r\n        if (!ai) {\r\n            console.warn(\"AI Service: No API Key, returning mock analysis V2.\");\r\n            await new Promise(r => setTimeout(r, 1500));\r\n            return {\r\n                ack: \"I see you're focusing on a specific project challenge.\",\r\n                primaryFocus: {\r\n                    dimension: \"structural_clarity\",\r\n                    headline: \"Let's organize the story\",\r\n                    body: \"You jumped straight into the solution. Start by setting the context so I understand the stakes.\"\r\n                },\r\n                whyThisMatters: \"Without context, the impact of your actions is hard to judge.\",\r\n                observations: [\"Started with 'I decided to...'\", \"Mentioned '20% increase' at the end\"],\r\n                nextAction: {\r\n                    label: \"Try again with STAR\",\r\n                    actionType: \"redo_answer\"\r\n                },\r\n                meta: {\r\n                    tier: 1,\r\n                    modality: audioData ? \"voice\" : \"text\",\r\n                    signalQuality: \"emerging\",\r\n                    confidence: \"medium\"\r\n                },\r\n                transcript: answerText || \"Audio Answer (Mock)\"\r\n            };\r\n        }\r\n\r\n        try {\r\n            const parts: any[] = [\r\n                { text: systemPrompt },\r\n                { text: contextPrompt }, // Injected Blueprint/Intake Context\r\n                { text: schemaPrompt }\r\n            ];\r\n\r\n            if (audioData) {\r\n                parts.push({\r\n                    inlineData: {\r\n                        mimeType: audioData.mimeType,\r\n                        data: audioData.base64\r\n                    }\r\n                });\r\n                parts.push({ text: \"Please transcribe the audio and analyze it. Return the transcript in the 'transcript' field.\" });\r\n            } else if (answerText) {\r\n                parts.push({ text: `USER ANSWER: \"${answerText}\"` });\r\n            } else {\r\n                throw new Error(\"No input provided (text or audio)\");\r\n            }\r\n\r\n            const response = await ai.models.generateContent({\r\n                model: 'gemini-2.5-flash',\r\n                contents: {\r\n                    parts: parts\r\n                },\r\n                config: {\r\n                    responseMimeType: 'application/json',\r\n                },\r\n            });\r\n\r\n            const text = response.text;\r\n            if (!text) throw new Error(\"Empty AI Response\");\r\n\r\n            const result = JSON.parse(text);\r\n\r\n            // Ensure transcript exists (from AI or input)\r\n            const finalTranscript = result.transcript || answerText || \"Audio Answer\";\r\n\r\n            return {\r\n                ...result,\r\n                transcript: finalTranscript,\r\n                // Map to legacy for safety if UI needs it\r\n                readinessBand: \"RL2\",\r\n                coachReaction: result.ack,\r\n                strengths: result.observations || [],\r\n                opportunities: [result.primaryFocus?.headline || \"Review feedback\"]\r\n            };\r\n\r\n        } catch (error) {\r\n            console.error(\"AI Analysis Failed\", error);\r\n            // Fallback V2\r\n            return {\r\n                ack: \"I noted your answer.\",\r\n                primaryFocus: {\r\n                    dimension: \"structural_clarity\",\r\n                    headline: \"System Offline\",\r\n                    body: \"I couldn't analyze that response right now. Please try again.\"\r\n                },\r\n                observations: [],\r\n                nextAction: { label: \"Move On\", actionType: \"next_question\" },\r\n                transcript: answerText || \"Audio Answer\",\r\n                readinessBand: \"RL2\",\r\n                coachReaction: \"Error\",\r\n                strengths: [],\r\n                opportunities: []\r\n            };\r\n        }\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\dev\\Interview-Coach-Recruiter\\src\\lib\\server\\session\\orchestrator.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'SessionStatus' is defined but never used.","line":1,"column":38,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":51,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"SessionStatus"},"fix":{"range":[35,50],"text":""},"desc":"Remove unused variable \"SessionStatus\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":69,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":69,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1958,1961],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1958,1961],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { InterviewSession, Question, SessionStatus } from \"@/lib/domain/types\";\r\nimport { uuidv7 } from \"uuidv7\";\r\nimport { InitSessionSchema } from \"@/lib/domain/schemas\";\r\nimport { z } from \"zod\";\r\n\r\n// --- Pure Domain Functions ---\r\n\r\nexport function createSession(\r\n    input: z.infer<typeof InitSessionSchema>\r\n): InterviewSession {\r\n    // Validate input (runtime check)\r\n    const data = InitSessionSchema.parse(input);\r\n\r\n    const newSession: InterviewSession = {\r\n        id: uuidv7(),\r\n        status: \"NOT_STARTED\",\r\n        role: data.role,\r\n        jobDescription: data.jobDescription,\r\n        questions: [],\r\n        currentQuestionIndex: 0,\r\n        answers: {},\r\n        initialsRequired: true, // Default policy: always require initials if not authenticated\r\n    };\r\n\r\n    return newSession;\r\n}\r\n\r\nexport function addQuestions(session: InterviewSession, questions: Question[]): InterviewSession {\r\n    return {\r\n        ...session,\r\n        questions: questions\r\n    };\r\n}\r\n\r\nexport function startSession(session: InterviewSession): InterviewSession {\r\n    if (session.status !== \"NOT_STARTED\") {\r\n        throw new Error(\"Session has already started\");\r\n    }\r\n\r\n    return {\r\n        ...session,\r\n        status: \"IN_SESSION\",\r\n    };\r\n}\r\n\r\nexport function nextQuestion(session: InterviewSession): InterviewSession {\r\n    const nextIndex = session.currentQuestionIndex + 1;\r\n    const isComplete = nextIndex >= session.questions.length;\r\n\r\n    if (isComplete) {\r\n        return {\r\n            ...session,\r\n            status: \"COMPLETED\"\r\n        }\r\n    }\r\n\r\n    return {\r\n        ...session,\r\n        currentQuestionIndex: nextIndex,\r\n        // Status stays IN_SESSION unless we have logic to pause/review between questions\r\n        // For V1, we assume continuous flow or client-driven pause\r\n    };\r\n}\r\n\r\nexport function submitAnswer(\r\n    session: InterviewSession,\r\n    questionId: string,\r\n    answerText: string,\r\n    analysis?: any\r\n): InterviewSession {\r\n    // Basic state update - in a real app, this might trigger eval\r\n    const updatedAnswers = {\r\n        ...session.answers,\r\n        [questionId]: {\r\n            questionId,\r\n            transcript: answerText,\r\n            submittedAt: Date.now(),\r\n            analysis: analysis // Persist analysis if provided\r\n        }\r\n    };\r\n\r\n    return {\r\n        ...session,\r\n        answers: updatedAnswers,\r\n        status: analysis ? \"REVIEWING\" : \"AWAITING_EVALUATION\"\r\n    };\r\n}\r\n\r\nexport function getAnalysisContext(session: InterviewSession, questionId: string) {\r\n    const question = session.questions.find(q => q.id === questionId);\r\n    if (!question) return null;\r\n    return { question };\r\n}\r\n\r\nexport function submitInitials(session: InterviewSession, initials: string): InterviewSession {\r\n    return {\r\n        ...session,\r\n        enteredInitials: initials,\r\n        initialsRequired: false // Gate passed\r\n    };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\dev\\Interview-Coach-Recruiter\\src\\lib\\services\\dashboard-constitution.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Answer' is defined but never used.","line":8,"column":28,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":34,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Answer"},"fix":{"range":[222,230],"text":""},"desc":"Remove unused variable \"Answer\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'AnalysisResult' is defined but never used.","line":8,"column":36,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":50,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"AnalysisResult"},"fix":{"range":[230,246],"text":""},"desc":"Remove unused variable \"AnalysisResult\"."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Dashboard Constitution Service\r\n * \r\n * Implements the \"Log facts. Infer meaning.\" data architecture.\r\n * Transforms raw session data (Layer 1) into interpretive signals (Layer 3).\r\n */\r\n\r\nimport { InterviewSession, Answer, AnalysisResult } from '@/lib/domain/types';\r\n\r\n// --- Layer 2: Derived Metrics ---\r\n\r\ninterface CompetencyMetric {\r\n    id: string;\r\n    totalQuestions: number;\r\n    attempted: number;\r\n    strongSignals: number; // e.g., RL3/RL4\r\n}\r\n\r\nexport interface SessionMetrics {\r\n    totalAnswers: number;\r\n    completionRate: number;\r\n    competencyProfile: Record<string, CompetencyMetric>;\r\n    consistencyScore: number; // 0-1\r\n}\r\n\r\nexport function computeMetrics(session: InterviewSession): SessionMetrics {\r\n    const questions = session.questions;\r\n    const answers = Object.values(session.answers);\r\n\r\n    // Stub implementation\r\n    return {\r\n        totalAnswers: answers.length,\r\n        completionRate: questions.length > 0 ? answers.length / questions.length : 0,\r\n        competencyProfile: {},\r\n        consistencyScore: 0.5 // Neutral default\r\n    };\r\n}\r\n\r\n// --- Layer 3: Interpretive Signals ---\r\n\r\nexport enum SignalQuality {\r\n    Insufficient = 'Insufficient',\r\n    Emerging = 'Emerging',\r\n    Reliable = 'Reliable',\r\n    Strong = 'Strong'\r\n}\r\n\r\nexport interface CoachingSignals {\r\n    baseline: {\r\n        text: string;\r\n        quality: SignalQuality;\r\n    };\r\n    constellation: {\r\n        strengths: string[];\r\n        gaps: string[];\r\n    };\r\n    coachingFocus: {\r\n        focus: string;\r\n        rationale: string;\r\n        action: string;\r\n    };\r\n}\r\n\r\nexport function generateSignals(session: InterviewSession, metrics: SessionMetrics): CoachingSignals {\r\n    // 1. Determine Signal Quality\r\n    let quality = SignalQuality.Insufficient;\r\n    if (metrics.totalAnswers >= 1) quality = SignalQuality.Emerging;\r\n    if (metrics.totalAnswers >= 3) quality = SignalQuality.Reliable;\r\n\r\n    // 2. Generate Baseline\r\n    let baselineText = \"Based on limited recent practice, it appears you are just getting started.\";\r\n    if (quality === SignalQuality.Emerging) {\r\n        baselineText = \"Your recent answers suggest you are building a foundation.\";\r\n    } else if (quality === SignalQuality.Reliable) {\r\n        baselineText = \"Your answers are consistently demonstrating core competencies.\";\r\n    }\r\n\r\n    // 3. Generate Focus (Stub Logic)\r\n    return {\r\n        baseline: {\r\n            text: baselineText,\r\n            quality\r\n        },\r\n        constellation: {\r\n            strengths: [],\r\n            gaps: []\r\n        },\r\n        coachingFocus: {\r\n            focus: \"Build Consistency\",\r\n            rationale: \"You have started answering, but more data is needed to identify specific patterns.\",\r\n            action: \"Complete at least 3 questions to unlock detailed insights.\"\r\n        }\r\n    };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\dev\\Interview-Coach-Recruiter\\src\\lib\\state\\selectors.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'hasInitials' is assigned a value but never used.","line":20,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":20,"endColumn":22}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { InterviewSession } from \"@/lib/domain/types\";\r\nimport { NowState, ScreenId } from \"./now.types\";\r\n\r\nexport function selectNow(session?: InterviewSession): NowState {\r\n    if (!session) {\r\n        return {\r\n            isLoaded: false,\r\n            status: \"NOT_STARTED\",\r\n            requiresInitials: false,\r\n            canStart: false,\r\n            isComplete: false,\r\n            currentQuestionIndex: 0,\r\n            totalQuestions: 0,\r\n            screen: \"ERROR\", // Default to safe error/loading state\r\n        };\r\n    }\r\n\r\n    const { status, initialsRequired, candidateName, questions, currentQuestionIndex, answers } = session;\r\n\r\n    const hasInitials = !!candidateName;\r\n    const isComplete = status === \"COMPLETED\";\r\n    const currentQ = questions[currentQuestionIndex];\r\n    const currentAns = currentQ ? answers[currentQ.id] : undefined;\r\n\r\n    // Screen Selection Logic (Deterministic Priority)\r\n    let screen: ScreenId = \"ERROR\";\r\n\r\n    if (status === \"ERROR\") {\r\n        screen = \"ERROR\";\r\n    } else if (initialsRequired) {\r\n        screen = \"INITIALS\";\r\n    } else if (status === \"NOT_STARTED\") {\r\n        screen = \"LANDING\";\r\n    } else if (status === \"COMPLETED\") {\r\n        screen = \"SUMMARY\";\r\n    } else {\r\n        // In-Session Logic\r\n        // In-Session Logic\r\n        // Determine sub-state based on Data, not just Status Enum (which is limited in DB)\r\n        if (currentAns?.analysis) {\r\n            screen = \"REVIEW_FEEDBACK\";\r\n        } else if (status === \"AWAITING_EVALUATION\") {\r\n            // Transient state (memory only usually)\r\n            screen = \"PENDING_EVALUATION\";\r\n        } else if (currentAns?.submittedAt && !currentAns.analysis) {\r\n            // If answer submitted but no analysis, we are effectively pending evaluation\r\n            // This covers the case where DB says \"IN_SESSION\" but we are waiting for AI\r\n            screen = \"PENDING_EVALUATION\";\r\n        } else if (status === \"REVIEWING\") {\r\n            screen = \"REVIEW_FEEDBACK\";\r\n        } else {\r\n            // Default: User needs to answer\r\n            screen = \"ACTIVE_QUESTION\";\r\n        }\r\n    }\r\n\r\n    return {\r\n        isLoaded: true,\r\n        status,\r\n        role: session.role,\r\n        requiresInitials: initialsRequired,\r\n        canStart: status === \"NOT_STARTED\",\r\n        isComplete,\r\n        currentQuestionId: currentQ?.id,\r\n        currentQuestionIndex,\r\n        totalQuestions: questions.length,\r\n        screen,\r\n    };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\dev\\Interview-Coach-Recruiter\\src\\lib\\supabase\\middleware.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'options' is defined but never used.","line":21,"column":58,"nodeType":"Identifier","messageId":"unusedVar","endLine":21,"endColumn":65}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createServerClient } from '@supabase/ssr'\r\nimport { NextResponse, type NextRequest } from 'next/server'\r\n\r\nexport async function updateSession(request: NextRequest) {\r\n    const isRecruiter = request.nextUrl.pathname.startsWith('/recruiter');\r\n    const start = Date.now();\r\n\r\n    let supabaseResponse = NextResponse.next({\r\n        request,\r\n    })\r\n\r\n    const supabase = createServerClient(\r\n        process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n        process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\r\n        {\r\n            cookies: {\r\n                getAll() {\r\n                    return request.cookies.getAll()\r\n                },\r\n                setAll(cookiesToSet) {\r\n                    cookiesToSet.forEach(({ name, value, options }) => request.cookies.set(name, value))\r\n                    supabaseResponse = NextResponse.next({\r\n                        request,\r\n                    })\r\n                    cookiesToSet.forEach(({ name, value, options }) =>\r\n                        supabaseResponse.cookies.set(name, value, {\r\n                            ...options,\r\n                            secure: process.env.NODE_ENV === 'production',\r\n                        })\r\n                    )\r\n                },\r\n            },\r\n        }\r\n    )\r\n\r\n    // IMPORTANT: Avoid writing any logic between createServerClient and\r\n    // supabase.auth.getUser(). A simple mistake could make it very hard to debug\r\n    // issues with users being randomly logged out.\r\n\r\n    // Optimization: Skip getUser if no Supabase cookies are present\r\n    // This avoids unnecessary network calls on public pages for unauthenticated users\r\n    const hasAuthCookie = request.cookies.getAll().some(c => c.name.startsWith('sb-'));\r\n\r\n    if (hasAuthCookie) {\r\n        await supabase.auth.getUser();\r\n    }\r\n\r\n    if (isRecruiter) console.log(`[Middleware] ${request.nextUrl.pathname} took ${Date.now() - start}ms`);\r\n\r\n    return supabaseResponse\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\dev\\Interview-Coach-Recruiter\\src\\lib\\supabase\\server.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'CookieOptions' is defined but never used.","line":1,"column":35,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":48,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"CookieOptions"},"fix":{"range":[27,47],"text":""},"desc":"Remove unused variable \"CookieOptions\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'cookiesToSet' is defined but never used.","line":44,"column":24,"nodeType":"Identifier","messageId":"unusedVar","endLine":44,"endColumn":36}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createServerClient, type CookieOptions } from '@supabase/ssr'\r\nimport { cookies } from 'next/headers'\r\nimport { cache } from 'react';\r\n\r\nexport function createClient() {\r\n    const cookieStore = cookies()\r\n\r\n    return createServerClient(\r\n        process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n        process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\r\n        {\r\n            cookies: {\r\n                getAll() {\r\n                    return cookieStore.getAll()\r\n                },\r\n                setAll(cookiesToSet) {\r\n                    try {\r\n                        cookiesToSet.forEach(({ name, value, options }) =>\r\n                            cookieStore.set(name, value, {\r\n                                ...options,\r\n                                secure: process.env.NODE_ENV === 'production',\r\n                            })\r\n                        )\r\n                    } catch {\r\n                        // The `setAll` method was called from a Server Component.\r\n                        // This can be ignored if you have middleware refreshing\r\n                        // user sessions.\r\n                    }\r\n                },\r\n            },\r\n        }\r\n    )\r\n}\r\n\r\nexport function createAdminClient() {\r\n    return createServerClient(\r\n        process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n        process.env.SUPABASE_SERVICE_ROLE_KEY!,\r\n        {\r\n            cookies: {\r\n                getAll() {\r\n                    return []\r\n                },\r\n                setAll(cookiesToSet) {\r\n                }\r\n            }\r\n        }\r\n    )\r\n}\r\n\r\nexport const getCachedUser = cache(async () => {\r\n    const supabase = createClient();\r\n    const { data: { user } } = await supabase.auth.getUser();\r\n    return user;\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\dev\\Interview-Coach-Recruiter\\src\\screens\\InterviewSessionScreen.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'SessionProvider' is defined but never used.","line":3,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":25,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"SessionProvider"},"fix":{"range":[15,73],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'sessionId' is defined but never used.","line":14,"column":50,"nodeType":"Identifier","messageId":"unusedVar","endLine":14,"endColumn":59},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'initialConfig' is defined but never used.","line":14,"column":61,"nodeType":"Identifier","messageId":"unusedVar","endLine":14,"endColumn":74}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\n\nimport { SessionProvider } from \"@/context/SessionContext\"\nimport SessionOrchestrator from \"@/components/session/SessionOrchestrator\"\n\ninterface InterviewSessionScreenProps {\n  sessionId?: string;\n  initialConfig?: {\n    role: string;\n    jobDescription?: string;\n  }\n}\n\nexport default function InterviewSessionScreen({ sessionId, initialConfig }: InterviewSessionScreenProps) {\n  // SessionProvider is now handled at the Layout level (CandidateLayoutClient)\n  return (\n    <SessionOrchestrator />\n  )\n}\n","usedDeprecatedRules":[]},{"filePath":"C:\\dev\\Interview-Coach-Recruiter\\src\\screens\\session\\ActiveQuestionScreen.tsx","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":330,"column":33,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[15184,15219],"text":"\r\n                                &quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[15184,15219],"text":"\r\n                                &ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[15184,15219],"text":"\r\n                                &#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[15184,15219],"text":"\r\n                                &rdquo;"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":330,"column":57,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[15242,15273],"text":"&quot;\r\n                            "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[15242,15273],"text":"&ldquo;\r\n                            "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[15242,15273],"text":"&#34;\r\n                            "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[15242,15273],"text":"&rdquo;\r\n                            "},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'totalQuestions' is defined but never used.","line":31,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":31,"endColumn":19,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'prev' is defined but never used.","line":86,"column":23,"nodeType":"Identifier","messageId":"unusedVar","endLine":86,"endColumn":27,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, useRef } from \"react\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { Question } from \"@/lib/domain/types\"\r\nimport { AnimatePresence, motion } from \"framer-motion\"\r\nimport { useSpeechToText } from \"@/hooks/audio/useSpeechToText\";\r\nimport { useAudioRecording } from \"@/hooks/audio/useAudioRecording\";\r\nimport { useTextToSpeech } from \"@/hooks/audio/useTextToSpeech\";\r\nimport AudioVisualizer from \"@/components/audio/AudioVisualizer\";\r\nimport { Mic, Lightbulb, Volume2, StopCircle, Loader2, X, ArrowRight, Keyboard } from \"lucide-react\"\r\nimport { useSession } from \"@/context/SessionContext\"\r\nimport { EngagementDebugOverlay } from \"@/components/debug/EngagementDebugOverlay\"\r\nimport { cn } from \"@/lib/cn\"\r\n\r\n\r\ninterface ActiveQuestionScreenProps {\r\n    question: Question;\r\n    currentQuestionIndex: number;\r\n    totalQuestions: number;\r\n    initialAnswer: string;\r\n    onSaveDraft: (text: string) => void;\r\n    onSubmit: (answer: string) => void;\r\n    // New Actions for Revisit/Nav\r\n    retryQuestion: () => void;\r\n    goToQuestion: (index: number) => void;\r\n    nextQuestion: () => void;\r\n}\r\n\r\nexport default function ActiveQuestionScreen({\r\n    question,\r\n    currentQuestionIndex,\r\n    totalQuestions, // eslint-disable-line @typescript-eslint/no-unused-vars\r\n    initialAnswer,\r\n    onSaveDraft,\r\n    onSubmit,\r\n    retryQuestion,\r\n    goToQuestion,\r\n    nextQuestion\r\n}: ActiveQuestionScreenProps) {\r\n    const {\r\n        session,\r\n        // updateSession, \r\n        trackEvent,\r\n        engagementDebugEvents,\r\n        // clearDebugEvents,\r\n        isEngagementWindowOpen,\r\n        engagementWindowTimeRemaining\r\n    } = useSession();\r\n\r\n    // compute currentAns locally for Revisit Mode logic\r\n    const currentAns = session?.answers[question.id];\r\n\r\n    // --- 1. Engagement & State ---\r\n    const [answer, setAnswer] = useState(initialAnswer);\r\n    const lastSaved = useRef(initialAnswer);\r\n    const [isSaving, setIsSaving] = useState(false);\r\n    const [showDebug, setShowDebug] = useState(false);\r\n    const [mode, setMode] = useState<'voice' | 'text'>('voice');\r\n\r\n    // --- Audio Hooks ---\r\n    const {\r\n        // isListening,\r\n        transcript,\r\n        startListening,\r\n        stopListening,\r\n        resetTranscript: resetDetailedTranscript\r\n    } = useSpeechToText();\r\n\r\n    const {\r\n        isRecording,\r\n        isInitializing: isRecordingInitializing,\r\n        startRecording,\r\n        stopRecording,\r\n        mediaStream\r\n    } = useAudioRecording();\r\n\r\n    const {\r\n        speak,\r\n        stop: stopSpeaking,\r\n        isPlaying: isSpeaking,\r\n        isLoading: isTTSLoading\r\n    } = useTextToSpeech();\r\n\r\n    // Sync transcripts logic\r\n    useEffect(() => {\r\n        if (transcript) {\r\n            setAnswer(prev => { // eslint-disable-line @typescript-eslint/no-unused-vars\r\n                // If the user hasn't typed anything manually (or specifically focused text mode?), replace?\r\n                // For now, let's just use the transcript as the source of truth when listening.\r\n                return transcript;\r\n            });\r\n        }\r\n    }, [transcript]);\r\n\r\n    const handleToggleRecording = async () => {\r\n        if (isRecording) {\r\n            trackEvent('tier2', 'mic_stop');\r\n            stopListening();\r\n            await stopRecording();\r\n            // ... (rest of logic)\r\n        } else {\r\n            trackEvent('tier2', 'mic_start');\r\n            setAnswer(\"\");\r\n            resetDetailedTranscript();\r\n            startListening();\r\n            await startRecording();\r\n        }\r\n    };\r\n\r\n    const handleTogglePlayback = () => {\r\n        trackEvent('tier2', 'tts_toggle');\r\n        if (isSpeaking) {\r\n            stopSpeaking();\r\n        } else {\r\n            speak(question.text);\r\n        }\r\n    };\r\n\r\n    // Hint System State\r\n    const [hintOpen, setHintOpen] = useState(false);\r\n    const [selectedHintCat, setSelectedHintCat] = useState<string | null>(null);\r\n\r\n    // Engagement Tracker (Hoisted)\r\n    const hasLoggedEntry = useRef(false);\r\n\r\n    // Trigger window open on mount/entry\r\n    useEffect(() => {\r\n        if (session?.status === 'IN_SESSION' && !hasLoggedEntry.current) {\r\n            trackEvent('tier3', 'session_entry');\r\n            hasLoggedEntry.current = true;\r\n        }\r\n    }, [session?.status, trackEvent]); // Run when status confirms we are in session\r\n\r\n    // Auto-Save\r\n    useEffect(() => {\r\n        const timeout = setTimeout(() => {\r\n            if (answer !== lastSaved.current) {\r\n                setIsSaving(true);\r\n                onSaveDraft(answer);\r\n                lastSaved.current = answer;\r\n                setTimeout(() => setIsSaving(false), 800);\r\n            }\r\n        }, 1000);\r\n        return () => clearTimeout(timeout);\r\n    }, [answer, onSaveDraft]);\r\n\r\n    const handleLocalSubmit = (ans: string) => {\r\n        trackEvent('tier3', 'submit', 60); // 60s window for feedback reading (Tier 3 opens window)\r\n        onSubmit(ans);\r\n    };\r\n\r\n    // --- 2. Hint Content Logic ---\r\n    // Mock logic based on Tier\r\n    const tier = session?.coachingPreference || 'tier1';\r\n\r\n    const hints = {\r\n        structure: \"Start with the situation, then explain your action, and end with the result.\",\r\n        outcome: \"Focus on what changed because of your actions, not just what you did.\",\r\n        focus: \"Keep the story centered on your specific contribution.\"\r\n    };\r\n\r\n    const renderHintContent = () => {\r\n        if (tier === 'tier0') {\r\n            return (\r\n                <div className=\"p-4 bg-amber-50 rounded-lg text-amber-900 text-sm animate-in fade-in\">\r\n                    <strong>Tip:</strong> You can focus on one example—what happened, what you did, and what changed.\r\n                </div>\r\n            );\r\n        }\r\n\r\n        // Tier 1 & 2\r\n        if (!selectedHintCat) {\r\n            return (\r\n                <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-2 animate-in fade-in\">\r\n                    <button onClick={() => { setSelectedHintCat('structure'); trackEvent('tier2', 'hint_click', 45); }} className=\"text-xs p-2 border rounded hover:bg-slate-50 text-slate-600\">Structuring your answer</button>\r\n                    <button onClick={() => { setSelectedHintCat('outcome'); trackEvent('tier2', 'hint_click', 45); }} className=\"text-xs p-2 border rounded hover:bg-slate-50 text-slate-600\">Explaining the outcome</button>\r\n                    <button onClick={() => { setSelectedHintCat('focus'); trackEvent('tier2', 'hint_click', 45); }} className=\"text-xs p-2 border rounded hover:bg-slate-50 text-slate-600\">Staying focused</button>\r\n                </div>\r\n            )\r\n        }\r\n\r\n        return (\r\n            <div className=\"p-4 bg-blue-50/50 border border-blue-100 rounded-lg text-slate-700 text-sm animate-in fade-in\">\r\n                <div className=\"flex justify-between items-start mb-1\">\r\n                    <span className=\"font-semibold text-blue-900 text-xs uppercase tracking-wider\">{selectedHintCat}</span>\r\n                    <button onClick={() => setSelectedHintCat(null)} className=\"text-xs text-blue-400 hover:text-blue-600\">Back</button>\r\n                </div>\r\n                {hints[selectedHintCat as keyof typeof hints]}\r\n            </div>\r\n        )\r\n    };\r\n\r\n    // --- 3. Render ---\r\n    return (\r\n        <div className=\"flex flex-col bg-slate-50 relative selection:bg-emerald-100\">\r\n\r\n            {/* Header / Nav */}\r\n            <header className=\"px-6 py-4 border-b bg-white flex justify-between items-center sticky top-0 z-10\">\r\n                {/* Left Spacer (matches width of Right Status) - roughly 100px */}\r\n                <div className=\"hidden sm:block w-[100px]\" />\r\n\r\n                {/* Question Navigator (Tabs) */}\r\n                <div className=\"hidden sm:flex flex-1 max-w-2xl mx-auto justify-center items-center gap-1 sm:gap-2 px-4 sm:px-6\">\r\n                    {session?.questions.map((q, idx) => {\r\n                        const isCurrent = idx === currentQuestionIndex;\r\n                        const isAnswered = !!session.answers[q.id]?.submittedAt;\r\n                        const firstUnansweredIdx = session.questions.findIndex(qu => !session.answers[qu.id]?.submittedAt);\r\n                        const maxClickable = firstUnansweredIdx === -1 ? session.questions.length - 1 : firstUnansweredIdx;\r\n                        const isClickable = idx <= maxClickable;\r\n\r\n                        return (\r\n                            <button\r\n                                key={q.id}\r\n                                onClick={() => { if (isClickable) { trackEvent('tier2', 'nav_click'); goToQuestion(idx); } }}\r\n                                disabled={!isClickable}\r\n                                className={cn(\r\n                                    \"flex-1 relative py-2 text-xs font-bold transition-all group\",\r\n                                    isClickable && !isCurrent ? \"hover:bg-muted/50 rounded-md\" : \"\"\r\n                                )}\r\n                            >\r\n                                <span className={cn(\r\n                                    \"relative z-10 px-1\",\r\n                                    isCurrent ? \"text-blue-600\" :\r\n                                        isAnswered ? \"text-slate-400\" : // Neutral for answered\r\n                                            isClickable ? \"text-slate-500\" : \"text-slate-300\"\r\n                                )}>\r\n                                    Q{idx + 1}\r\n                                </span>\r\n\r\n                                {/* Underline Indicator */}\r\n                                <div className={cn(\r\n                                    \"absolute bottom-0 left-0 right-0 h-0.5 transition-all\",\r\n                                    isCurrent ? \"bg-blue-600\" :\r\n                                        isAnswered ? \"bg-emerald-500\" : // Green underline for answered\r\n                                            \"bg-transparent\"\r\n                                )} />\r\n                            </button>\r\n                        );\r\n                    })}\r\n                </div>\r\n\r\n                {/* Right: In Session Status (Width locked approx 100px for centering) */}\r\n                <div className=\"hidden sm:flex w-[100px] justify-end\">\r\n                    <div className=\"flex items-center gap-1.5 opacity-60\">\r\n                        <div className=\"w-2 h-2 rounded-full bg-emerald-500 animate-pulse\" />\r\n                        <span className=\"text-xs font-semibold tracking-wide uppercase text-slate-600\">In Session</span>\r\n                    </div>\r\n                </div>\r\n            </header >\r\n\r\n            <main className=\"flex-1 max-w-2xl w-full mx-auto p-4 sm:p-6 flex flex-col gap-6\">\r\n\r\n                {/* TRANSCRIPT BLOCK (Question Context) */}\r\n                <div className=\"space-y-4\">\r\n                    {/* The Question */}\r\n                    <AnimatePresence mode=\"wait\">\r\n                        <motion.div\r\n                            key={question.id}\r\n                            initial={{ opacity: 0, y: 10 }}\r\n                            animate={{ opacity: 1, y: 0 }}\r\n                            exit={{ opacity: 0, y: -10 }}\r\n                            className=\"bg-transparent pl-1\"\r\n                        >\r\n                            <div className=\"flex justify-between items-end mb-2\">\r\n                                <div className=\"text-xs uppercase tracking-wide font-bold text-slate-400\">\r\n                                    {question.category}\r\n                                </div>\r\n                                {/* Audio Control - Moved here */}\r\n                                <button\r\n                                    onClick={handleTogglePlayback}\r\n                                    disabled={isTTSLoading}\r\n                                    className=\"flex items-center gap-1.5 px-2 py-0.5 rounded hover:bg-slate-50 text-[10px] text-blue-600 hover:text-blue-700 uppercase font-bold transition-colors\"\r\n                                >\r\n                                    {isTTSLoading ? (\r\n                                        <span className=\"animate-pulse\">Loading...</span>\r\n                                    ) : isSpeaking ? (\r\n                                        <>\r\n                                            <StopCircle size={12} className=\"animate-pulse text-red-500\" /> Stop\r\n                                        </>\r\n                                    ) : (\r\n                                        <>\r\n                                            <Volume2 size={12} /> Read Question\r\n                                        </>\r\n                                    )}\r\n                                </button>\r\n                            </div>\r\n                            <h2 className=\"text-2xl sm:text-3xl font-sans text-slate-800 leading-tight\">\r\n                                {question.text}\r\n                            </h2>\r\n                            <p className=\"text-slate-400 text-sm mt-3 font-medium italic\">\r\n                                Take your time.\r\n                            </p>\r\n                        </motion.div>\r\n                    </AnimatePresence>\r\n\r\n                    {/* HINT SYSTEM */}\r\n                    {!hintOpen && answer.length === 0 && !currentAns?.submittedAt && (\r\n                        <button\r\n                            onClick={() => setHintOpen(true)}\r\n                            className=\"text-xs font-medium text-right w-full text-slate-400 hover:text-emerald-600 transition-colors flex items-center justify-start gap-1.5 mt-2\"\r\n                        >\r\n                            <Lightbulb className=\"w-3 h-3\" />\r\n                            Need a hint?\r\n                        </button>\r\n                    )}\r\n\r\n                    {hintOpen && (\r\n                        <div className=\"mt-4 animate-in slide-in-from-top-2 duration-300 relative\">\r\n                            <button\r\n                                onClick={() => setHintOpen(false)}\r\n                                className=\"absolute -top-2 -right-2 p-1.5 bg-white/50 hover:bg-white rounded-full text-slate-400 hover:text-slate-600 transition-all z-10\"\r\n                                aria-label=\"Close Hint\"\r\n                            >\r\n                                <X size={14} />\r\n                            </button>\r\n                            {renderHintContent()}\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                {/* SPACER */}\r\n                <div className=\"flex-1\" />\r\n\r\n                {/* INPUT BLOCK vs REVISIT BLOCK */}\r\n                {currentAns?.submittedAt ? (\r\n                    // --- REVISIT MODE ---\r\n                    <div className=\"bg-white rounded-xl border border-slate-200 p-6 shadow-sm\">\r\n                        <div className=\"mb-6\">\r\n                            <h3 className=\"text-xs uppercase tracking-wider font-bold text-slate-400 mb-2\">Your Answer</h3>\r\n                            <div className=\"text-lg text-slate-700 italic font-sans leading-relaxed\">\r\n                                \"{currentAns.transcript}\"\r\n                            </div>\r\n                        </div>\r\n\r\n                        <div className=\"flex flex-col gap-3\">\r\n                            <Button\r\n                                onClick={() => {\r\n                                    setAnswer(\"\");\r\n                                    retryQuestion();\r\n                                }}\r\n                                className=\"w-full bg-blue-600 hover:bg-blue-700 text-white shadow-md hover:shadow-lg transition-all\"\r\n                            >\r\n                                Try My Answer Again\r\n                            </Button>\r\n\r\n                            <Button\r\n                                variant=\"ghost\"\r\n                                onClick={() => {\r\n                                    const firstUnanswered = session?.questions.find((_, idx) => {\r\n                                        const qid = session.questions[idx].id;\r\n                                        return !session.answers[qid]?.submittedAt;\r\n                                    });\r\n                                    if (firstUnanswered) {\r\n                                        goToQuestion(firstUnanswered.index);\r\n                                    } else {\r\n                                        nextQuestion();\r\n                                    }\r\n                                }}\r\n                                className=\"w-full text-slate-400 hover:text-slate-600\"\r\n                            >\r\n                                Continue to next question\r\n                            </Button>\r\n                        </div>\r\n                    </div>\r\n                ) : (\r\n                    // --- INPUT MODE ---\r\n                    <div className=\"relative flex-1 min-h-[400px] flex flex-col w-full\">\r\n\r\n                        {mode === 'voice' ? (\r\n                            <>\r\n                                {/* Visualizer Layer */}\r\n                                <div className=\"absolute inset-0 flex items-center justify-center opacity-40 pointer-events-none\">\r\n                                    {isRecording && (\r\n                                        <AudioVisualizer\r\n                                            stream={mediaStream}\r\n                                            isRecording={isRecording}\r\n                                            className=\"w-full h-full max-w-sm bg-transparent\"\r\n                                        />\r\n                                    )}\r\n                                </div>\r\n\r\n                                {/* Mic Button - Absolute Center of ENTIRE container */}\r\n                                <div className=\"absolute inset-0 flex items-center justify-center z-10 pointer-events-none\">\r\n                                    <button\r\n                                        onClick={handleToggleRecording}\r\n                                        disabled={isRecordingInitializing}\r\n                                        className={cn(\r\n                                            \"pointer-events-auto group relative w-20 h-20 rounded-full flex items-center justify-center transition-all duration-300\",\r\n                                            isRecording\r\n                                                ? \"bg-red-50 text-red-500 border-4 border-red-200 scale-110\"\r\n                                                : \"bg-blue-600 text-white hover:bg-blue-700 shadow-xl\"\r\n                                        )}\r\n                                    >\r\n                                        {isRecordingInitializing ? (\r\n                                            <Loader2 className=\"animate-spin w-8 h-8\" />\r\n                                        ) : (\r\n                                            <Mic\r\n                                                size={32}\r\n                                                className={cn(isRecording && \"animate-pulse\")}\r\n                                            />\r\n                                        )}\r\n\r\n                                        {isRecording && (\r\n                                            <span className=\"absolute inset-0 rounded-full border-4 border-red-400 animate-ping opacity-20\"></span>\r\n                                        )}\r\n                                    </button>\r\n                                </div>\r\n\r\n                                {/* Status Text - Positioned below center */}\r\n                                <div className=\"absolute top-1/2 left-0 right-0 pt-16 flex justify-center z-20 pointer-events-none\">\r\n                                    <div className=\"pointer-events-auto text-center space-y-2 max-w-md px-4\">\r\n                                        <p className=\"text-sm font-normal text-slate-400\">\r\n                                            {isRecording ? \"Listening...\" : \"Tap the microphone to start recording\"}\r\n                                        </p>\r\n                                        <div className=\"min-h-[60px] flex items-center justify-center\">\r\n                                            <p className=\"text-lg text-slate-700 italic font-sans leading-relaxed line-clamp-3\">\r\n                                                {transcript || answer || (isRecording ? \"...\" : \"\")}\r\n                                            </p>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <div className=\"flex-1\" />\r\n                            </>\r\n                        ) : (\r\n                            <div className=\"relative flex-1 p-4 mb-4\">\r\n                                <textarea\r\n                                    className=\"w-full h-full bg-transparent text-lg text-slate-800 placeholder:text-slate-300 outline-none resize-none\"\r\n                                    placeholder=\"Type your answer here...\"\r\n                                    value={answer}\r\n                                    onChange={(e) => {\r\n                                        setAnswer(e.target.value);\r\n                                        if (hintOpen && e.target.value.length > 5) setHintOpen(false);\r\n                                        trackEvent('tier2', 'typing');\r\n                                    }}\r\n                                    autoFocus\r\n                                />\r\n                            </div>\r\n                        )}\r\n\r\n                        {/* Actions Footer */}\r\n                        <div className=\"p-4 flex flex-col items-center gap-4 z-30 relative mt-auto\">\r\n\r\n                            {/* Next Button */}\r\n                            {answer.trim().length > 0 && (\r\n                                <Button\r\n                                    size=\"lg\"\r\n                                    onClick={() => handleLocalSubmit(answer)}\r\n                                    className=\"w-full sm:w-auto min-w-[200px] bg-blue-600 hover:bg-blue-700 text-white shadow-md transition-all animate-in zoom-in-95 duration-200\"\r\n                                >\r\n                                    Next <ArrowRight className=\"ml-2 w-4 h-4\" />\r\n                                </Button>\r\n                            )}\r\n\r\n                            {/* Saving Indicator */}\r\n                            <div className=\"h-4\">\r\n                                <span className={cn(\r\n                                    \"text-[10px] uppercase font-bold tracking-widest transition-colors duration-300\",\r\n                                    isSaving ? \"text-amber-500\" : \"opacity-0\"\r\n                                )}>\r\n                                    {isSaving ? \"Saving...\" : \"\"}\r\n                                </span>\r\n                            </div>\r\n\r\n                            {/* Mode Toggle */}\r\n                            <div className=\"flex items-center gap-1 p-1 bg-slate-200/50 rounded-full backdrop-blur-sm\">\r\n                                <button\r\n                                    onClick={() => setMode('voice')}\r\n                                    className={cn(\r\n                                        \"p-2 rounded-full transition-all duration-200\",\r\n                                        mode === 'voice'\r\n                                            ? \"bg-white text-blue-600 shadow-sm scale-110\"\r\n                                            : \"text-slate-400 hover:text-slate-600\"\r\n                                    )}\r\n                                    title=\"Voice Mode\"\r\n                                >\r\n                                    <Mic size={20} />\r\n                                </button>\r\n                                <button\r\n                                    onClick={() => setMode('text')}\r\n                                    className={cn(\r\n                                        \"p-2 rounded-full transition-all duration-200\",\r\n                                        mode === 'text'\r\n                                            ? \"bg-white text-blue-600 shadow-sm scale-110\"\r\n                                            : \"text-slate-400 hover:text-slate-600\"\r\n                                    )}\r\n                                    title=\"Text Mode\"\r\n                                >\r\n                                    <Keyboard size={20} />\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                <div className=\"h-4\" />\r\n            </main>\r\n\r\n            {/* Debug Overlay */}\r\n            <EngagementDebugOverlay\r\n                isVisible={showDebug}\r\n                onClose={() => setShowDebug(false)}\r\n                tracker={{\r\n                    totalEngagedSeconds: session?.engagedTimeSeconds || 0,\r\n                    isWindowOpen: isEngagementWindowOpen,\r\n                    trackEvent,\r\n                    debugEvents: engagementDebugEvents,\r\n                    windowTimeRemaining: engagementWindowTimeRemaining,\r\n                    clearDebugEvents: () => console.log(\"Clear events not hoisted\")\r\n                }}\r\n            />\r\n            <div\r\n                className=\"fixed bottom-0 left-0 w-4 h-4 opacity-0 z-50 cursor-pointer\"\r\n                onClick={() => setShowDebug(true)}\r\n                title=\"Debug\"\r\n            />\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\dev\\Interview-Coach-Recruiter\\src\\screens\\session\\ErrorScreen.tsx","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":7,"column":64,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[353,383],"text":"We couldn&apos;t load your session."},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[353,383],"text":"We couldn&lsquo;t load your session."},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[353,383],"text":"We couldn&#39;t load your session."},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[353,383],"text":"We couldn&rsquo;t load your session."},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Button } from \"@/components/ui/button\"\r\n\r\nexport default function ErrorScreen() {\r\n    return (\r\n        <div className=\"flex min-h-screen flex-col items-center justify-center p-4 text-center\">\r\n            <h2 className=\"mb-2 text-xl font-bold text-destructive\">Something went wrong</h2>\r\n            <p className=\"mb-6 text-muted-foreground\">We couldn't load your session.</p>\r\n            <Button variant=\"outline\" onClick={() => window.location.reload()}>Try Again</Button>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\dev\\Interview-Coach-Recruiter\\src\\screens\\session\\InitialsScreen.tsx","messages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":44,"column":21,"nodeType":"JSXOpeningElement","endLine":44,"endColumn":104},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":45,"column":21,"nodeType":"JSXOpeningElement","endLine":45,"endColumn":104}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\nimport { motion } from 'framer-motion';\r\nimport { cn } from '@/lib/cn';\r\nimport { Button } from '@/components/ui/button';\r\nimport { useSession } from '@/context/SessionContext';\r\n\r\nexport default function InitialsScreen() {\r\n    const { session, submitInitials } = useSession();\r\n    const [initials, setInitials] = useState('');\r\n    const [isFocused, setIsFocused] = useState(false);\r\n    const [isStarting, setIsStarting] = useState(false);\r\n\r\n    const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        // Only allow letters, max 2 chars\r\n        const val = e.target.value\r\n            .toUpperCase()\r\n            .replace(/[^A-Z]/g, '')\r\n            .slice(0, 2);\r\n        setInitials(val);\r\n    };\r\n\r\n    const handleBegin = async () => {\r\n        if (initials.length > 0) {\r\n            setIsStarting(true);\r\n            try {\r\n                await submitInitials(initials);\r\n            } catch (err) {\r\n                console.error('Failed to submit initials', err);\r\n                setIsStarting(false);\r\n            }\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"min-h-[100dvh] w-full bg-background font-sans text-foreground selection:bg-primary/10 selection:text-primary overflow-y-auto\">\r\n            <motion.div\r\n                initial={{ opacity: 0, y: 10 }}\r\n                animate={{ opacity: 1, y: 0 }}\r\n                transition={{ duration: 0.4, ease: 'easeOut' }}\r\n                className=\"w-full max-w-xl mx-auto px-6 py-12 md:py-24 space-y-12\"\r\n            >\r\n                {/* 1. Logo Area */}\r\n                <div className=\"flex justify-between items-center\">\r\n                    <img src=\"/TA-logo.svg\" alt=\"TalentArbor\" className=\"h-24 w-auto object-contain\" />\r\n                    <img src=\"/rangam-logo.webp\" alt=\"Rangam\" className=\"h-12 w-auto object-contain\" />\r\n                </div>\r\n\r\n                {/* 2. Primary Heading */}\r\n                <div className=\"space-y-4 text-left\">\r\n                    <h1 className=\"text-3xl md:text-4xl font-medium tracking-tight text-primary leading-tight\">\r\n                        Interview Practice Session\r\n                    </h1>\r\n                </div>\r\n\r\n                {/* 3. Introductory Copy & 4. Reassurance */}\r\n                <div className=\"space-y-6 text-lg text-muted-foreground leading-relaxed text-left\">\r\n                    <p>\r\n                        You’ll be asked a series of interview-style questions related to a role you applied for.\r\n                        Your progress is saved automatically, and you can leave and return at any time using\r\n                        this link.\r\n                    </p>\r\n\r\n                    <div className=\"flex items-start gap-3 p-4 bg-primary/5 rounded-xl border border-primary/10 shadow-sm\">\r\n                        <p className=\"text-lg text-muted-foreground\">\r\n                            This is a practice experience, not a live interview.\r\n                        </p>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* 5. Visibility Statement */}\r\n                <div className=\"flex items-center gap-2 text-sm text-muted-foreground justify-start\">\r\n                    <span>The person who shared this link may review your responses to help guide your preparation. Only you can see coaching feedback received during practice.</span>\r\n                </div>\r\n\r\n                {/* 6. Initials Input */}\r\n                <div className=\"space-y-4\">\r\n                    <label htmlFor=\"initials-input\" className=\"block text-lg font-medium text-foreground\">\r\n                        Enter your initials to begin\r\n                    </label>\r\n                    <div className=\"relative group\">\r\n                        <input\r\n                            id=\"initials-input\"\r\n                            type=\"text\"\r\n                            value={initials}\r\n                            onChange={handleInputChange}\r\n                            onFocus={() => setIsFocused(true)}\r\n                            onBlur={() => setIsFocused(false)}\r\n                            placeholder=\"(e.g. AB)\"\r\n                            className={cn(\r\n                                'w-full px-4 py-4 text-2xl tracking-widest font-medium bg-muted/50 border rounded-xl outline-none transition-all duration-200',\r\n                                'placeholder:text-muted-foreground/70 placeholder:font-normal placeholder:tracking-normal',\r\n                                isFocused\r\n                                    ? 'border-primary ring-4 ring-primary/10'\r\n                                    : 'border-border hover:border-input'\r\n                            )}\r\n                        />\r\n                        {/* Feedback Text */}\r\n                        <p className=\"mt-2 text-sm text-muted-foreground\">\r\n                            *Used to confirm the session was opened by the intended person. ({session?.candidateName || \"Candidate\"})\r\n                        </p>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* 7. Primary CTA */}\r\n                <div className=\"pt-4 pb-8\">\r\n                    <Button\r\n                        onClick={handleBegin}\r\n                        disabled={initials.length === 0 || isStarting}\r\n                        className={cn(\r\n                            'w-full md:w-auto px-8 py-6 text-lg rounded-xl transition-all duration-200 shadow-sm h-auto',\r\n                            initials.length > 0\r\n                                ? 'bg-primary hover:bg-primary/90 text-primary-foreground hover:-translate-y-0.5'\r\n                                : 'bg-muted text-muted-foreground cursor-not-allowed hover:bg-muted'\r\n                        )}\r\n                    >\r\n                        {isStarting ? 'Starting...' : 'Begin practice'}\r\n                    </Button>\r\n                </div>\r\n\r\n                {/* 8. Footer Microcopy */}\r\n                <div className=\"text-left pt-8 border-t border-border\">\r\n                    <p className=\"text-sm text-muted-foreground\">\r\n                        You can return to this session anytime using the same link.\r\n                    </p>\r\n                </div>\r\n            </motion.div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\dev\\Interview-Coach-Recruiter\\src\\screens\\session\\IntakeScreen.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'useState' is defined but never used.","line":1,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":18,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"useState"},"fix":{"range":[0,33],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Button' is defined but never used.","line":2,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":16,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"Button"},"fix":{"range":[35,83],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'cn' is defined but never used.","line":3,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":12,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"cn"},"fix":{"range":[85,115],"text":""},"desc":"Remove unused import declaration."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from \"react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { cn } from \"@/lib/cn\";\r\n\r\ninterface IntakeScreenProps {\r\n    onComplete: (preference: 'tier0' | 'tier1' | 'tier2') => void;\r\n}\r\n\r\nexport default function IntakeScreen({ onComplete }: IntakeScreenProps) {\r\n    // No state needed for selection since we trigger immediately, \r\n    // unless we want a brief visual \"selected\" state before transition?\r\n    // User requested \"Just use the clicked option to proceed\". \r\n    // Immediate transition is snappier.\r\n\r\n    return (\r\n        <div className=\"flex min-h-screen flex-col items-center justify-center bg-background p-6\">\r\n            <div className=\"max-w-md w-full space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-500\">\r\n\r\n                {/* Header */}\r\n                <div className=\"space-y-2 text-center sm:text-left\">\r\n                    <h1 className=\"text-2xl font-bold tracking-tight text-foreground\">\r\n                        What kind of feedback would you like?\r\n                    </h1>\r\n                    <p className=\"text-xs text-muted-foreground pt-1\">\r\n                        You can change this later.\r\n                    </p>\r\n                </div>\r\n\r\n                {/* Options */}\r\n                <div className=\"space-y-3\">\r\n                    <button\r\n                        onClick={() => onComplete('tier0')}\r\n                        className=\"w-full text-left p-4 rounded-xl border-2 border-transparent bg-muted/50 hover:bg-muted hover:border-primary/50 transition-all duration-200 group\"\r\n                    >\r\n                        <div className=\"font-semibold text-foreground group-hover:text-primary transition-colors\">Just help me practice and feel comfortable</div>\r\n                        <div className=\"text-sm text-muted-foreground mt-1\">Best if you’re warming up or trying this for the first time.</div>\r\n                    </button>\r\n\r\n                    <button\r\n                        onClick={() => onComplete('tier1')}\r\n                        className=\"w-full text-left p-4 rounded-xl border-2 border-transparent bg-muted/50 hover:bg-muted hover:border-primary/50 transition-all duration-200 group\"\r\n                    >\r\n                        <div className=\"font-semibold text-foreground group-hover:text-primary transition-colors\">Help me improve how I answer interview questions</div>\r\n                        <div className=\"text-sm text-muted-foreground mt-1\">Focused on clarity and structure.</div>\r\n                    </button>\r\n\r\n                    <button\r\n                        onClick={() => onComplete('tier2')}\r\n                        className=\"w-full text-left p-4 rounded-xl border-2 border-transparent bg-muted/50 hover:bg-muted hover:border-primary/50 transition-all duration-200 group\"\r\n                    >\r\n                        <div className=\"font-semibold text-foreground group-hover:text-primary transition-colors\">Give me targeted coaching for this role</div>\r\n                        <div className=\"text-sm text-muted-foreground mt-1\">More specific guidance, when you want it.</div>\r\n                    </button>\r\n                </div>\r\n\r\n                {/* No Start Button */}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\dev\\Interview-Coach-Recruiter\\src\\screens\\session\\LandingScreen.tsx","messages":[{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":23,"column":28,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[1041,1139],"text":"\r\n                        Let&apos;s get you ready for your next big opportunity.\r\n                    "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[1041,1139],"text":"\r\n                        Let&lsquo;s get you ready for your next big opportunity.\r\n                    "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[1041,1139],"text":"\r\n                        Let&#39;s get you ready for your next big opportunity.\r\n                    "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[1041,1139],"text":"\r\n                        Let&rsquo;s get you ready for your next big opportunity.\r\n                    "},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Button } from \"@/components/ui/button\"\r\nimport { MonitorPlay, Clock, ShieldCheck } from \"lucide-react\"\r\n\r\ninterface LandingScreenProps {\r\n    onStart: () => void;\r\n    role?: string;\r\n}\r\n\r\nexport default function LandingScreen({ onStart, role = \"Candidate\" }: LandingScreenProps) {\r\n    return (\r\n        <div className=\"flex min-h-screen flex-col items-center justify-center bg-background p-6\">\r\n            <div className=\"bg-card shadow-lg border rounded-xl p-8 max-w-lg w-full text-center space-y-8\">\r\n\r\n                {/* Header */}\r\n                <div className=\"space-y-2\">\r\n                    <div className=\"mx-auto w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center mb-4\">\r\n                        <MonitorPlay className=\"w-6 h-6 text-primary\" />\r\n                    </div>\r\n                    <h1 className=\"text-2xl font-bold tracking-tight text-foreground\">\r\n                        {role} Interview Practice\r\n                    </h1>\r\n                    <p className=\"text-muted-foreground\">\r\n                        Let's get you ready for your next big opportunity.\r\n                    </p>\r\n                </div>\r\n\r\n                {/* Key Points */}\r\n                <div className=\"grid gap-4 text-left\">\r\n                    <div className=\"flex items-start gap-4 p-4 rounded-lg bg-muted/50\">\r\n                        <Clock className=\"w-5 h-5 text-primary mt-0.5\" />\r\n                        <div className=\"space-y-1\">\r\n                            <h3 className=\"font-medium\">No Time Limit</h3>\r\n                            <p className=\"text-sm text-muted-foreground\">\r\n                                Take your time to think. This is a safe space to practice, not a test.\r\n                            </p>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"flex items-start gap-4 p-4 rounded-lg bg-muted/50\">\r\n                        <ShieldCheck className=\"w-5 h-5 text-primary mt-0.5\" />\r\n                        <div className=\"space-y-1\">\r\n                            <h3 className=\"font-medium\">Private Feedback</h3>\r\n                            <p className=\"text-sm text-muted-foreground\">\r\n                                Your answers are analyzed by AI to give you instant, private coaching tips.\r\n                            </p>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* CTA */}\r\n                <div className=\"pt-4\">\r\n                    <Button size=\"lg\" className=\"w-full text-lg h-12\" onClick={onStart}>\r\n                        Start Practice Session\r\n                    </Button>\r\n                    <p className=\"text-xs text-muted-foreground mt-4\">\r\n                        By starting, you agree to our practice terms.\r\n                    </p>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\dev\\Interview-Coach-Recruiter\\src\\screens\\session\\ReviewFeedbackScreen.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'useEffect' is defined but never used.","line":1,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":19,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"useEffect"},"fix":{"range":[9,19],"text":""},"desc":"Remove unused variable \"useEffect\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'cn' is defined but never used.","line":5,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":12,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"cn"},"fix":{"range":[246,275],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":51,"column":25,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[2255,2282],"text":"\r\n                        &quot;"},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[2255,2282],"text":"\r\n                        &ldquo;"},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[2255,2282],"text":"\r\n                        &#34;"},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[2255,2282],"text":"\r\n                        &rdquo;"},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":51,"column":45,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[2301,2324],"text":"&quot;\r\n                    "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[2301,2324],"text":"&ldquo;\r\n                    "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[2301,2324],"text":"&#34;\r\n                    "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[2301,2324],"text":"&rdquo;\r\n                    "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":160,"column":34,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[8845,8940],"text":"\r\n                                I&apos;d like to try my answer again\r\n                            "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[8845,8940],"text":"\r\n                                I&lsquo;d like to try my answer again\r\n                            "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[8845,8940],"text":"\r\n                                I&#39;d like to try my answer again\r\n                            "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[8845,8940],"text":"\r\n                                I&rsquo;d like to try my answer again\r\n                            "},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useState } from \"react\"\r\nimport { Button } from \"@/components/ui/button\"\r\nimport { useSession } from \"@/context/SessionContext\"\r\nimport { ChevronDown, ChevronRight, CheckCircle2, AlertCircle, ArrowRight } from \"lucide-react\"\r\nimport { cn } from \"@/lib/cn\"\r\n// Ensure you import the CSS in layout or here (Global CSS preferred usually, but simple import works if configured)\r\nimport \"@/styles/loader.css\"\r\n\r\nexport default function ReviewFeedbackScreen() {\r\n    const { session, nextQuestion, retryQuestion, updateSession } = useSession(); // Corrected destructuring\r\n    const currentQ = session?.questions[session.currentQuestionIndex];\r\n    // Safe access:\r\n    const answer = currentQ ? session?.answers[currentQ.id] : undefined;\r\n    const analysis = answer?.analysis;\r\n\r\n    const [whyOpen, setWhyOpen] = useState(false);\r\n    const [obsOpen, setObsOpen] = useState(false);\r\n\r\n    // If no analysis yet, we show loader\r\n    const isThinking = !analysis || !analysis.primaryFocus;\r\n\r\n    if (!session || !currentQ || !answer) return <div className=\"p-8\">No session data.</div>;\r\n\r\n    // Helper: Label Mapping\r\n    const getDimensionLabel = (dim: string) => {\r\n        const map: Record<string, string> = {\r\n            'specificity_concreteness': 'Specific & Concrete',\r\n            'outcome_explicitness': 'Outcome Clarity',\r\n            'structural_clarity': 'Structure',\r\n            'decision_rationale': 'Decision Logic',\r\n            'focus_relevance': 'Focus',\r\n            'delivery_control': 'Delivery'\r\n        };\r\n        return map[dim] || dim.replace(/_/g, \" \");\r\n    };\r\n\r\n    const handleStop = async () => {\r\n        await updateSession(session.id, { status: \"PAUSED\" });\r\n    };\r\n\r\n    return (\r\n        <div className=\"flex flex-col min-h-screen bg-slate-50\">\r\n\r\n            {/* Answer Readonly Panel (Top) */}\r\n            <div className=\"bg-white border-b px-6 py-4 shadow-sm\">\r\n                <div className=\"max-w-3xl mx-auto\">\r\n                    <h2 className=\"text-sm font-semibold text-muted-foreground uppercase tracking-wider mb-2\">\r\n                        Your Answer\r\n                    </h2>\r\n                    <p className=\"text-lg text-slate-800 leading-relaxed font-sans italic opacity-90\">\r\n                        \"{answer.transcript}\"\r\n                    </p>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Feedback Region */}\r\n            <main className=\"flex-1 max-w-3xl w-full mx-auto p-6 flex flex-col gap-6 animate-in fade-in duration-500\">\r\n\r\n                {isThinking ? (\r\n                    <div className=\"thinking-loader p-8 bg-white rounded-xl shadow-sm mt-4 border border-slate-100\">\r\n                        <div className=\"flex items-center gap-3 mb-4\">\r\n                            <div className=\"w-2 h-2 bg-blue-400 rounded-full animate-pulse\" />\r\n                        </div>\r\n                        <div className=\"skeleton-line\" />\r\n                        <div className=\"skeleton-line short\" />\r\n                        <div className=\"skeleton-line\" />\r\n                    </div>\r\n                ) : (\r\n                    <>\r\n                        {/* Ack Text */}\r\n                        <div className=\"text-slate-600 font-medium px-1 text-lg\">\r\n                            {analysis.ack}\r\n                        </div>\r\n\r\n                        {/* Primary Focus Block */}\r\n                        <div className=\"bg-white border border-l-4 border-l-blue-500 rounded-lg shadow-sm p-6 space-y-3\">\r\n                            <div className=\"flex items-center gap-2 mb-1\">\r\n                                <span className=\"bg-blue-50 text-blue-700 text-[10px] uppercase font-bold px-2 py-0.5 rounded tracking-wide\">\r\n                                    {analysis.primaryFocus?.dimension ? getDimensionLabel(analysis.primaryFocus.dimension) : 'Feedback'}\r\n                                </span>\r\n                            </div>\r\n                            <h3 className=\"text-xl font-bold text-slate-900\">\r\n                                {analysis.primaryFocus?.headline}\r\n                            </h3>\r\n                            <p className=\"text-slate-700 leading-relaxed\">\r\n                                {analysis.primaryFocus?.body}\r\n                            </p>\r\n                        </div>\r\n\r\n                        {/* Collapsible: Why this helps */}\r\n                        {analysis.whyThisMatters && (\r\n                            <div className=\"border rounded-lg bg-white overflow-hidden\">\r\n                                <button\r\n                                    onClick={() => setWhyOpen(!whyOpen)}\r\n                                    // Header Styling: Light Blue (More visible)\r\n                                    className=\"w-full flex items-center justify-between p-4 bg-blue-50 hover:bg-blue-100 transition-colors text-left border-b border-transparent hover:border-blue-200\"\r\n                                >\r\n                                    <span className=\"font-semibold text-slate-700 flex items-center gap-2\">\r\n                                        <CheckCircle2 className=\"w-4 h-4 text-slate-400\" />\r\n                                        Why this helps\r\n                                    </span>\r\n                                    {whyOpen ? <ChevronDown size={16} /> : <ChevronRight size={16} />}\r\n                                </button>\r\n                                {whyOpen && (\r\n                                    <div className=\"p-4 pt-4 text-slate-600 bg-white\">\r\n                                        {analysis.whyThisMatters}\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        )}\r\n\r\n                        {/* Collapsible: What I noticed */}\r\n                        {analysis.observations && analysis.observations.length > 0 && (\r\n                            <div className=\"border rounded-lg bg-white overflow-hidden\">\r\n                                <button\r\n                                    onClick={() => setObsOpen(!obsOpen)}\r\n                                    // Header Styling: Blue Match\r\n                                    className=\"w-full flex items-center justify-between p-4 bg-blue-50 hover:bg-blue-100 transition-colors text-left border-b border-transparent hover:border-blue-200\"\r\n                                >\r\n                                    <span className=\"font-semibold text-slate-700 flex items-center gap-2\">\r\n                                        <AlertCircle className=\"w-4 h-4 text-slate-400\" />\r\n                                        What I noticed\r\n                                    </span>\r\n                                    {obsOpen ? <ChevronDown size={16} /> : <ChevronRight size={16} />}\r\n                                </button>\r\n                                {obsOpen && (\r\n                                    <ul className=\"p-4 pt-2 space-y-2 border-t bg-slate-50/50\">\r\n                                        {analysis.observations.map((obs, idx) => (\r\n                                            <li key={idx} className=\"flex gap-2 text-slate-600 text-sm\">\r\n                                                <span className=\"opacity-50\">•</span> {obs}\r\n                                            </li>\r\n                                        ))}\r\n                                    </ul>\r\n                                )}\r\n                            </div>\r\n                        )}\r\n\r\n                        {/* Suggested Action (Text Only) */}\r\n                        {analysis.nextAction && (\r\n                            <div className=\"px-1 pt-2\">\r\n                                <p className=\"text-sm font-medium text-slate-500 uppercase tracking-wider mb-1\">Suggested Action</p>\r\n                                <p className=\"text-slate-700 font-medium\">{analysis.nextAction.label}</p>\r\n                            </div>\r\n                        )}\r\n\r\n                        {/* Actions Buttons */}\r\n                        <div className=\"pt-2 flex flex-col gap-3\">\r\n                            <Button\r\n                                size=\"lg\"\r\n                                className=\"w-full text-lg h-12 shadow-md hover:shadow-lg transition-all bg-blue-600 hover:bg-blue-700\"\r\n                                onClick={nextQuestion}\r\n                            >\r\n                                Continue to the Next Question <ArrowRight className=\"ml-2 w-5 h-5\" />\r\n                            </Button>\r\n\r\n                            <button\r\n                                onClick={retryQuestion}\r\n                                className=\"text-sm font-medium text-slate-500 hover:text-slate-800 transition-colors py-2\"\r\n                            >\r\n                                I'd like to try my answer again\r\n                            </button>\r\n\r\n                            <button\r\n                                onClick={handleStop}\r\n                                className=\"text-sm font-medium text-slate-400 hover:text-slate-600 transition-colors py-2\"\r\n                            >\r\n                                Stop for now\r\n                            </button>\r\n                        </div>\r\n                    </>\r\n                )}\r\n\r\n            </main>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]}]